<!DOCTYPE html>
<!-- Generated by pkgdown + https://github.com/insightsengineering/r-pkgdown-multiversion -->
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using unihtee • unihtee</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using unihtee">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">unihtee</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/using-unihtee.html">Using unihtee</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      <div><li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-versions">Versions</a>
    <div class="dropdown-menu" aria-labelledby="dropdown-versions">
    <a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/unihtee/main">main</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/unihtee/latest-tag">latest-tag</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/unihtee/v0.0.1">v0.0.1</a>
</div>
</li></div>
</ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Using unihtee</h1>
                        <h4 data-toc-skip class="author"><a href="https://pboileau.ca" class="external-link">Philippe Boileau</a></h4>
            
            <h4 data-toc-skip class="date">2025-07-07</h4>
      

      <div class="d-none name"><code>using-unihtee.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tlverse.org/sl3" class="external-link">sl3</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">Rsolnp</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://glmnet.stanford.edu" class="external-link">glmnet</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dmlc/xgboost" class="external-link">xgboost</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://imbs-hl.github.io/ranger/" class="external-link">ranger</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.milbo.users.sonic.net/earth/" class="external-link">earth</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">unihtee</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>Treatment effect modifiers (TEMs) are responsible for the disparate
effects of a treatment on a population. They modify the effect of
treatment on the outcome. In precision medicine, these effect modifiers
delineate patient subgroups which experience differing benefit from a
given medical intervention. In public health, they are used to determine
the effect of policy decisions on sub-populations. Identifying TEMs, if
any exist, is required for a comprehensive understanding of an
intervention’s effect on a population.</p>
<p>Traditional parametric modelling techniques, like generalized linear
models (GLMs), define TEMs as the pre-treatment covariates with non-zero
treatment interaction terms. In settings characterized by time-to-event
outcomes, the Cox proportional hazards model can similarly be used.
Inference about TEMs is therefore possible under stringent conditions
about the data-generating process. When these (semi-) parametric
methods’ assumptions, like linearity of the covariate-outcome
relationship in a linear model or proportional hazards in a Cox model,
are violated, however, their inference are invalid.</p>
<p>More flexible approaches instead focus on estimating the conditional
average treatment effect (CATE) using interpretable modelling
techniques, like the LASSO <span class="citation">(Tibshirani 1996; Tian
et al. 2014; S. Chen et al. 2017; Q. Zhao, Small, and Ertefaie 2018;
Semenova and Chernozhukov 2020; Bahamyirou et al. 2022)</span> or Random
Forests <span class="citation">(Breiman 2001; Wager and Athey 2018; Cui
et al. 2022)</span>. Again, however, these methods require restrictive
assumptions about the data-generating process, like sparsity of
treatment effect modification <span class="citation">(P. Zhao and Yu
2006)</span>, approximately uncorrelated covariates <span class="citation">(P. Zhao and Yu 2006; Hastie, Tibshirani, and Friedman
2009)</span>, and sample sizes that are much larger than the number of
potential TEMs <span class="citation">(P. Zhao and Yu 2006)</span>, to
reliably recover TEMs.</p>
<p>Instead of identifying TEMs indirectly by parametric modelling,
recent work has developed frameworks tailored to the task <span class="citation">(Williamson et al. 2022; Boileau et al. 2022, 2025;
Hines, Diaz-Ordaz, and Vansteelandt 2022)</span>. Relying on TEM
variable importance parameters (TEM-VIPs), it is possible to assess
pre-treatment covariates’ influence on the treatment effect in
nonparametric, algorithm-agnostic fashion that largely avoids the
pitfalls of parametric and CATE-based methodologies. These TEM-VIPs are
defined within nonparametric statistical models that may be augmented
with causal interpretations, permitting formal causal inference about
TEMs.</p>
<p>The <code>unihtee</code> R package implements the recent proposals of
<span class="citation">Boileau et al. (2022)</span> and <span class="citation">Boileau et al. (2025)</span>. This TEM-VIP framework
relies on parameters assess the marginal effect of each pre-treatment
covariate on treatment effect heterogeneity, however treatment effect is
defined. Nonparametric estimators are provided in these works, and their
asymptotic properties established. In particular, these estimators are
shown to be asymptotically linear under minimal assumptions about the
data-generating process, and to recover treatment effect modifiers more
readily than competing methods. These TEM-VIPs and estimators are
introduced alongside worked examples in the following section.</p>
</div>
<div class="section level2">
<h2 id="unihtee-in-action">
<code>unihtee</code> in Action<a class="anchor" aria-label="anchor" href="#unihtee-in-action"></a>
</h2>
<p>The <code>unihtee</code> R package performs inference about TEM-VIPs
in data-generating processes with a binary exposure variable and either
continuous, binary, or right-censored time-to-event outcomes. No
restriction is placed on the pre-treatment covariates variables, though
ordinal variables should be formatted as factors using
<code><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered()</a></code>, and categorical variables should be one-hot
encoded.</p>
<div class="section level3">
<h3 id="working-with-continuous-outcomes">Working with Continuous Outcomes<a class="anchor" aria-label="anchor" href="#working-with-continuous-outcomes"></a>
</h3>
<p>Let there be
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
independent and identically distributed (i.i.d.) random vectors
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><msub><mi>X</mi><mi>i</mi></msub><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><annotation encoding="application/x-tex">{X_i}_{i=1}^n</annotation></semantics></math>
such that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mi>i</mi></msub><mo>=</mo><mo stretchy="false" form="prefix">(</mo><msub><mi>W</mi><mi>i</mi></msub><mo>,</mo><msub><mi>A</mi><mi>i</mi></msub><mo>,</mo><msup><mi>Y</mi><mrow><mo stretchy="false" form="prefix">(</mo><mn>0</mn><mo stretchy="false" form="postfix">)</mo></mrow></msup><mo>,</mo><msubsup><mi>Y</mi><mi>i</mi><mrow><mo stretchy="false" form="prefix">(</mo><mn>1</mn><mo stretchy="false" form="postfix">)</mo></mrow></msubsup><mo stretchy="false" form="postfix">)</mo><mo>∼</mo><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub><mo>∈</mo><msub><mi>ℳ</mi><mi>X</mi></msub></mrow><annotation encoding="application/x-tex">X_i = (W_i, A_i, Y^{(0)}, Y_i^{(1)}) \sim P_{X,0} \in
\mathcal{M}_X</annotation></semantics></math>. Dropping the index where
possible for notational convenience for the remainder of the tutorial,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>W</mi><annotation encoding="application/x-tex">W</annotation></semantics></math>
is defined as the set of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
pre-treatment covariates,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>A</mi><annotation encoding="application/x-tex">A</annotation></semantics></math>
as the binary treatment indicator, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>Y</mi><mrow><mo stretchy="false" form="prefix">(</mo><mn>0</mn><mo stretchy="false" form="postfix">)</mo></mrow></msup><mo>,</mo><msubsup><mi>Y</mi><mi>i</mi><mrow><mo stretchy="false" form="prefix">(</mo><mn>1</mn><mo stretchy="false" form="postfix">)</mo></mrow></msubsup></mrow><annotation encoding="application/x-tex">Y^{(0)}, Y_i^{(1)}</annotation></semantics></math>
the continuous potential outcomes <span class="citation">(Rubin
1974)</span> produced under control and treatment conditions,
respectively. Further,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ℳ</mi><mi>X</mi></msub><annotation encoding="application/x-tex">\mathcal{M}_X</annotation></semantics></math>
is the full-data nonparametric model of all possible data-generating
processes, and contains the true but unknown full-data data-generating
process
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub><annotation encoding="application/x-tex">P_{X,0}</annotation></semantics></math>.
We note that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>W</mi><annotation encoding="application/x-tex">W</annotation></semantics></math>
contains both the confounders treatment-outcome confounders and the
potential TEMs, possibly overlapping sets of variables.</p>
<p>Now,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub><annotation encoding="application/x-tex">P_{X,0}</annotation></semantics></math>
is generally unknown because its random vectors are unobservable: only
one potential outcome is ever measurable in practice. Still,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub><annotation encoding="application/x-tex">P_{X,0}</annotation></semantics></math>
allows to us to readily define causal parameters on which inference may
subsequently be performed. Examples are given in the subsections
below.</p>
<p>We instead have access to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
i.i.d. random observations
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo>=</mo><mo stretchy="false" form="prefix">(</mo><mi>W</mi><mo>,</mo><mi>A</mi><mo>,</mo><mi>Y</mi><mo stretchy="false" form="postfix">)</mo><mo>∼</mo><msub><mi>P</mi><mn>0</mn></msub><mo>∈</mo><mi>ℳ</mi></mrow><annotation encoding="application/x-tex">O=(W,A,Y) \sim P_0 \in
\mathcal{M}</annotation></semantics></math>, where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>W</mi><annotation encoding="application/x-tex">W</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>A</mi><annotation encoding="application/x-tex">A</annotation></semantics></math>
are defined as in the full-data, and where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>=</mo><mi>A</mi><msup><mi>Y</mi><mrow><mo stretchy="false" form="prefix">(</mo><mn>1</mn><mo stretchy="false" form="postfix">)</mo></mrow></msup><mo>+</mo><mo stretchy="false" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>A</mi><mo stretchy="false" form="postfix">)</mo><mi>Y</mi><mrow><mo stretchy="false" form="prefix">(</mo><mn>0</mn><mo stretchy="false" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">Y =
AY^{(1)} + (1-A)Y{(0)}</annotation></semantics></math>.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ℳ</mi><annotation encoding="application/x-tex">\mathcal{M}</annotation></semantics></math>
is the observed-data statistical model containing all possible
observed-data data-generating processes, including the true
data-generating process
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mn>0</mn></msub><annotation encoding="application/x-tex">P_{0}</annotation></semantics></math>.
Note too that the elements of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ℳ</mi><annotation encoding="application/x-tex">\mathcal{M}</annotation></semantics></math>
are fully specified by their full-data counterparts in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ℳ</mi><mi>X</mi></msub><annotation encoding="application/x-tex">\mathcal{M}_{X}</annotation></semantics></math>.</p>
<p>Having established the requisite statistical objects, let’s define a
data-generating process:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cont_outcome_dgp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n_obs</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># pre-treatment covariates</span></span>
<span>  <span class="va">w_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_obs</span><span class="op">)</span></span>
<span>  <span class="va">w_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_obs</span><span class="op">)</span></span>
<span>  <span class="va">w_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_obs</span><span class="op">)</span></span>
<span>  <span class="va">w_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_obs</span><span class="op">)</span></span>
<span>  <span class="va">w_5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_obs</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># treatment</span></span>
<span>  <span class="va">prop_score</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">w_1</span> <span class="op">+</span> <span class="va">w_2</span><span class="op">)</span></span>
<span>  <span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n_obs</span>, <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">prop_score</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># potential outcomes</span></span>
<span>  <span class="va">y_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_obs</span>, mean <span class="op">=</span> <span class="va">w_1</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">w_2</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">w_3</span> <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="va">a</span>, sd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span>  <span class="va">y_0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_obs</span>, mean <span class="op">=</span> <span class="va">w_1</span> <span class="op">+</span> <span class="va">w_2</span>, sd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># outcome</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">a</span> <span class="op">*</span> <span class="va">y_1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">a</span><span class="op">)</span> <span class="op">*</span> <span class="va">y_0</span></span>
<span></span>
<span>  <span class="co"># assemble the observations in a tibble</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    w_1 <span class="op">=</span> <span class="va">w_1</span>,</span>
<span>    w_2 <span class="op">=</span> <span class="va">w_2</span>,</span>
<span>    w_3 <span class="op">=</span> <span class="va">w_3</span>,</span>
<span>    w_4 <span class="op">=</span> <span class="va">w_4</span>,</span>
<span>    w_5 <span class="op">=</span> <span class="va">w_5</span>,</span>
<span>    a <span class="op">=</span> <span class="va">a</span>,</span>
<span>    y <span class="op">=</span> <span class="va">y</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>It’s clear from the definition of the potential outcomes that
<code>w_2</code> and <code>w_3</code> are treatment effect modifiers:
they interact with the treatment indicator <code>a</code>. Note too that
<code>w_1</code> and <code>w_2</code> are confounders. A TEM-VIP for
quantifying the strength of the treatment effect modification of
<code>w_1</code> through <code>w_5</code> is outlined next.</p>
<div class="section level4">
<h4 id="absolute-tem-vip">Absolute TEM-VIP<a class="anchor" aria-label="anchor" href="#absolute-tem-vip"></a>
</h4>
<p>Indexing
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>W</mi><annotation encoding="application/x-tex">W</annotation></semantics></math>
by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>…</mi><mo>,</mo><mi>p</mi></mrow><annotation encoding="application/x-tex">j=1,\ldots,p</annotation></semantics></math>,
and assuming without loss of generality that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>𝔼</mi><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub></msub><mo stretchy="false" form="prefix">[</mo><msub><mi>W</mi><mi>j</mi></msub><mo stretchy="false" form="postfix">]</mo><mo>=</mo><mn>0</mn><mo>,</mo><msub><mi>𝔼</mi><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub></msub><mo stretchy="false" form="prefix">[</mo><msubsup><mi>W</mi><mi>j</mi><mn>2</mn></msubsup><mo stretchy="false" form="postfix">]</mo><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\mathbb{E}_{P_{X,0}}[W_j] = 0, \mathbb{E}_{P_{X,0}}[W_j^2] &gt; 0</annotation></semantics></math>,
we can define our first TEM-VIP for the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>j</mi><mtext mathvariant="normal">th</mtext></msup><annotation encoding="application/x-tex">j^\text{th}</annotation></semantics></math>
pre-treatment covariate as follows:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi mathvariant="normal">Ψ</mi><mi>j</mi><mi>F</mi></msubsup><mo stretchy="false" form="prefix">(</mo><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub><mo stretchy="false" form="postfix">)</mo><mo>=</mo><mfrac><mrow><msub><mtext mathvariant="normal">Cov</mtext><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub></msub><mo stretchy="false" form="prefix">[</mo><mo stretchy="false" form="prefix">(</mo><msup><mi>Y</mi><mrow><mo stretchy="false" form="prefix">(</mo><mn>1</mn><mo stretchy="false" form="postfix">)</mo></mrow></msup><mo>−</mo><msup><mi>Y</mi><mrow><mo stretchy="false" form="prefix">(</mo><mn>0</mn><mo stretchy="false" form="postfix">)</mo></mrow></msup><mo stretchy="false" form="postfix">)</mo><mo>,</mo><msub><mi>W</mi><mi>j</mi></msub><mo stretchy="false" form="postfix">]</mo></mrow><mrow><msub><mi>𝕍</mi><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub></msub><mo stretchy="false" form="prefix">[</mo><msub><mi>W</mi><mi>j</mi></msub><mo stretchy="false" form="postfix">]</mo></mrow></mfrac><mspace width="0.278em"></mspace><mi>.</mi></mrow><annotation encoding="application/x-tex">
\Psi^F_j(P_{X,0}) =
\frac{\text{Cov}_{P_{X,0}}[(Y^{(1)}-Y^{(0)}), W_j]}{\mathbb{V}_{P_{X,0}}[W_j]}
\;.
</annotation></semantics></math></p>
<p>This parameter is called the <em>absolute TEM-VIP</em>. Assuming the
expectation of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>𝔼</mi><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub></msub><mo stretchy="false" form="prefix">[</mo><msup><mi>Y</mi><mrow><mo stretchy="false" form="prefix">(</mo><mn>1</mn><mo stretchy="false" form="postfix">)</mo></mrow></msup><mo stretchy="false" form="prefix">|</mo><mi>W</mi><mo stretchy="false" form="postfix">]</mo><mo>−</mo><msub><mi>𝔼</mi><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub></msub><mo stretchy="false" form="prefix">[</mo><msup><mi>Y</mi><mrow><mo stretchy="false" form="prefix">(</mo><mn>0</mn><mo stretchy="false" form="postfix">)</mo></mrow></msup><mo stretchy="false" form="prefix">|</mo><mi>W</mi><mo stretchy="false" form="postfix">]</mo></mrow><annotation encoding="application/x-tex">\mathbb{E}_{P_{X,0}}[Y^{(1)}|W] - \mathbb{E}_{P_{X,0}}[Y^{(0)}|W]</annotation></semantics></math>
conditional on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>W</mi><mi>j</mi></msub><annotation encoding="application/x-tex">W_j</annotation></semantics></math>
is linear in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>W</mi><mi>j</mi></msub><annotation encoding="application/x-tex">W_j</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi mathvariant="normal">Ψ</mi><mi>j</mi><mi>F</mi></msubsup><mo stretchy="false" form="prefix">(</mo><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">\Psi^F_j(P_{X,0})</annotation></semantics></math>
is the simple linear regression coefficient produced by regressing the
difference in expected potential outcomes against
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mi>j</mi></msub><mo>−</mo><msub><mi>𝔼</mi><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub></msub><mo stretchy="false" form="prefix">[</mo><msub><mi>W</mi><mi>j</mi></msub><mo stretchy="false" form="postfix">]</mo></mrow><annotation encoding="application/x-tex">W_j - \mathbb{E}_{P_{X,0}}[W_j]</annotation></semantics></math>.
Even when this relationship is nonlinear, as is almost surely the case
in most applications,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi mathvariant="normal">Ψ</mi><mi>j</mi><mi>F</mi></msubsup><mo stretchy="false" form="prefix">(</mo><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">\Psi^F_j(P_{X,0})</annotation></semantics></math>
corresponds to the correlation between the difference in potential
outcomes and the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>j</mi><mtext mathvariant="normal">th</mtext></msup><annotation encoding="application/x-tex">j^\text{th}</annotation></semantics></math>
covariate, re-normalized to be on the same scale as the potential
outcomes.</p>
<p>Of course, as stated earlier, we don’t generally have access to the
full-data random vectors required to perform inference about the above
parameter. Luckily, under the identification conditions outlined in
<span class="citation">Boileau et al. (2022)</span> and <span class="citation">Boileau et al. (2025)</span> — namely, that there is no
unmeasured confounding and no positivity violations — we can perform
inference about the equivalent observed-data parameter:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">Ψ</mi><mi>j</mi></msub><mo stretchy="false" form="prefix">(</mo><msub><mi>P</mi><mn>0</mn></msub><mo stretchy="false" form="postfix">)</mo><mo>=</mo><mfrac><mrow><msub><mtext mathvariant="normal">Cov</mtext><msub><mi>P</mi><mn>0</mn></msub></msub><mo stretchy="false" form="prefix">[</mo><msub><mi>𝔼</mi><msub><mi>P</mi><mn>0</mn></msub></msub><mo stretchy="false" form="prefix">[</mo><mi>Y</mi><mo stretchy="false" form="prefix">|</mo><mi>A</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>W</mi><mo stretchy="false" form="postfix">]</mo><mo>−</mo><msub><mi>𝔼</mi><msub><mi>P</mi><mn>0</mn></msub></msub><mo stretchy="false" form="prefix">[</mo><mi>Y</mi><mo stretchy="false" form="prefix">|</mo><mi>A</mi><mo>=</mo><mn>0</mn><mo>,</mo><mi>W</mi><mo stretchy="false" form="postfix">]</mo><mo>,</mo><msub><mi>W</mi><mi>j</mi></msub><mo stretchy="false" form="postfix">]</mo></mrow><mrow><msub><mi>𝕍</mi><msub><mi>P</mi><mn>0</mn></msub></msub><mo stretchy="false" form="prefix">[</mo><msub><mi>W</mi><mi>j</mi></msub><mo stretchy="false" form="postfix">]</mo></mrow></mfrac><mo>=</mo><msubsup><mi mathvariant="normal">Ψ</mi><mi>j</mi><mi>F</mi></msubsup><mo stretchy="false" form="prefix">(</mo><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub><mo stretchy="false" form="postfix">)</mo><mspace width="0.278em"></mspace><mi>.</mi></mrow><annotation encoding="application/x-tex">
\Psi_j(P_0)
=\frac{\text{Cov}_{P_0}[\mathbb{E}_{P_{0}}[Y|A=1,W]-
  \mathbb{E}_{P_0}[Y|A=0,W], W_j]}{\mathbb{V}_{P_0}[W_j]} 
= \Psi^F_j(P_{X,0})\;.
</annotation></semantics></math></p>
<p><span class="citation">Boileau et al. (2022)</span> and <span class="citation">Boileau et al. (2025)</span> derive two nonparametric
estimators of this parameter: the one-step and targeted maximum
likelihood (TML) estimators. Both require the estimation of two nuisance
parameters: the propensity score and the expected outcome conditioned on
the treatment and pre-treatment covariates. These estimators are doubly
robust: only one nuisance parameter is required to be consistently
estimated to ensure that the one-step and TML estimators are consistent.
If both nuisance parameters converge to their true values at a fast
enough rate, then the one-step and TML estimators are asymptotically
normal. This permits hypothesis testing about
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">Ψ</mi><mi>j</mi></msub><mo stretchy="false" form="prefix">(</mo><msub><mi>P</mi><mn>0</mn></msub><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">\Psi_j(P_0)</annotation></semantics></math>
using Wald-type confidence intervals. Further details on these
estimators and their asymptotic properties are provided in <span class="citation">Boileau et al. (2022)</span> and <span class="citation">Boileau et al. (2025)</span>.</p>
<p>Having defined the parameter and briefly discussed the estimators, we
apply <code>unicate()</code> to recover the treatment effect modifiers,
as defined by the absolute TEM-VIP. Both the one-step and TML estimators
are showcased. The LASSO regression of <span class="citation">Tibshirani
(1996)</span> is used to estimate the nuisance parameters.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">514</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># simulate a random sample</span></span>
<span><span class="va">sample_df</span> <span class="op">&lt;-</span> <span class="fu">cont_outcome_dgp</span><span class="op">(</span>n_obs <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># one-step estimator</span></span>
<span><span class="fu"><a href="../reference/unihtee.html">unihtee</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">sample_df</span>,</span>
<span>  confounders <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_1"</span>, <span class="st">"w_2"</span>, <span class="st">"w_3"</span>, <span class="st">"w_4"</span>, <span class="st">"w_5"</span><span class="op">)</span>,</span>
<span>  modifiers <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_1"</span>, <span class="st">"w_2"</span>, <span class="st">"w_3"</span>, <span class="st">"w_4"</span>, <span class="st">"w_5"</span><span class="op">)</span>,</span>
<span>  exposure <span class="op">=</span> <span class="st">"a"</span>,</span>
<span>  outcome <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  outcome_type <span class="op">=</span> <span class="st">"continuous"</span>,</span>
<span>  effect <span class="op">=</span> <span class="st">"absolute"</span>,</span>
<span>  estimator <span class="op">=</span> <span class="st">"onestep"</span>,</span>
<span>  cond_outcome_estimator <span class="op">=</span> <span class="fu">sl3</span><span class="fu">::</span><span class="fu"><a href="https://tlverse.org/sl3/reference/Lrnr_base.html" class="external-link">make_learner</a></span><span class="op">(</span></span>
<span>    <span class="fu">sl3</span><span class="fu">::</span><span class="va"><a href="https://tlverse.org/sl3/reference/Pipeline.html" class="external-link">Pipeline</a></span>,</span>
<span>    <span class="fu">sl3</span><span class="fu">::</span><span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_define_interactions.html" class="external-link">Lrnr_define_interactions</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_1"</span>, <span class="st">"a"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_2"</span>, <span class="st">"a"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_3"</span>, <span class="st">"a"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_4"</span>, <span class="st">"a"</span><span class="op">)</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_5"</span>, <span class="st">"a"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu">sl3</span><span class="fu">::</span><span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_glmnet.html" class="external-link">Lrnr_glmnet</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  prop_score_estimator <span class="op">=</span> <span class="fu">sl3</span><span class="fu">::</span><span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_glmnet.html" class="external-link">Lrnr_glmnet</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    modifier   estimate        se          z      p_value    ci_lower  ci_upper</span></span>
<span><span class="co">#&gt;      &lt;fctr&gt;      &lt;num&gt;     &lt;num&gt;      &lt;num&gt;        &lt;num&gt;       &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      w_3  1.9489367 0.1292105 15.0834273 0.000000e+00  1.69568416 2.2021892</span></span>
<span><span class="co">#&gt; 2:      w_2  0.8490835 0.1150728  7.3786643 1.598721e-13  0.62354083 1.0746262</span></span>
<span><span class="co">#&gt; 3:      w_5  0.1451094 0.1094073  1.3263227 1.847328e-01 -0.06932893 0.3595477</span></span>
<span><span class="co">#&gt; 4:      w_4 -0.1313010 0.1214854 -1.0807961 2.797878e-01 -0.36941247 0.1068105</span></span>
<span><span class="co">#&gt; 5:      w_1 -0.0518593 0.1223479 -0.4238677 6.716623e-01 -0.29166110 0.1879425</span></span>
<span><span class="co">#&gt;     p_value_fdr</span></span>
<span><span class="co">#&gt;           &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: 0.000000e+00</span></span>
<span><span class="co">#&gt; 2: 3.996803e-13</span></span>
<span><span class="co">#&gt; 3: 3.078881e-01</span></span>
<span><span class="co">#&gt; 4: 3.497348e-01</span></span>
<span><span class="co">#&gt; 5: 6.716623e-01</span></span>
<span></span>
<span><span class="co"># TML estimator</span></span>
<span><span class="fu"><a href="../reference/unihtee.html">unihtee</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">sample_df</span>,</span>
<span>  confounders <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_1"</span>, <span class="st">"w_2"</span>, <span class="st">"w_3"</span>, <span class="st">"w_4"</span>, <span class="st">"w_5"</span><span class="op">)</span>,</span>
<span>  modifiers <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_1"</span>, <span class="st">"w_2"</span>, <span class="st">"w_3"</span>, <span class="st">"w_4"</span>, <span class="st">"w_5"</span><span class="op">)</span>,</span>
<span>  exposure <span class="op">=</span> <span class="st">"a"</span>,</span>
<span>  outcome <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  outcome_type <span class="op">=</span> <span class="st">"continuous"</span>,</span>
<span>  effect <span class="op">=</span> <span class="st">"absolute"</span>,</span>
<span>  estimator <span class="op">=</span> <span class="st">"tmle"</span>,</span>
<span>  cond_outcome_estimator <span class="op">=</span> <span class="fu">sl3</span><span class="fu">::</span><span class="fu"><a href="https://tlverse.org/sl3/reference/Lrnr_base.html" class="external-link">make_learner</a></span><span class="op">(</span></span>
<span>    <span class="fu">sl3</span><span class="fu">::</span><span class="va"><a href="https://tlverse.org/sl3/reference/Pipeline.html" class="external-link">Pipeline</a></span>,</span>
<span>    <span class="fu">sl3</span><span class="fu">::</span><span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_define_interactions.html" class="external-link">Lrnr_define_interactions</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_1"</span>, <span class="st">"a"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_2"</span>, <span class="st">"a"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_3"</span>, <span class="st">"a"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_4"</span>, <span class="st">"a"</span><span class="op">)</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_5"</span>, <span class="st">"a"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu">sl3</span><span class="fu">::</span><span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_glmnet.html" class="external-link">Lrnr_glmnet</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  prop_score_estimator <span class="op">=</span> <span class="fu">sl3</span><span class="fu">::</span><span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_glmnet.html" class="external-link">Lrnr_glmnet</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    modifier    estimate        se          z      p_value   ci_lower  ci_upper</span></span>
<span><span class="co">#&gt;      &lt;fctr&gt;       &lt;num&gt;     &lt;num&gt;      &lt;num&gt;        &lt;num&gt;      &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      w_3  1.91250564 0.1293286 14.7879507 0.000000e+00  1.6590215 2.1659898</span></span>
<span><span class="co">#&gt; 2:      w_2  0.81718180 0.1150533  7.1026343 1.223910e-12  0.5916773 1.0426864</span></span>
<span><span class="co">#&gt; 3:      w_5  0.15254387 0.1094359  1.3939106 1.633446e-01 -0.0619505 0.3670383</span></span>
<span><span class="co">#&gt; 4:      w_4 -0.11791391 0.1215815 -0.9698345 3.321290e-01 -0.3562136 0.1203858</span></span>
<span><span class="co">#&gt; 5:      w_1 -0.06414269 0.1224767 -0.5237135 6.004778e-01 -0.3041970 0.1759116</span></span>
<span><span class="co">#&gt;     p_value_fdr</span></span>
<span><span class="co">#&gt;           &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: 0.000000e+00</span></span>
<span><span class="co">#&gt; 2: 3.059775e-12</span></span>
<span><span class="co">#&gt; 3: 2.722410e-01</span></span>
<span><span class="co">#&gt; 4: 4.151613e-01</span></span>
<span><span class="co">#&gt; 5: 6.004778e-01</span></span></code></pre></div>
<p><code>unicate()</code> outputs a table of results summarizing the
TEM-VIP inference procedure for each potential treatment effect
modifier. This table ordered by the nominal p-value of the inference
procedure. Both the one-step and TML estimators correctly identify the
TEM-VIP of <code>w_2</code> and <code>w_3</code> as being non-zero based
on the false discovery rate adjusted p-values. Each estimator’s point
estimates are also close to their true parameter values; for every unit
increase in <code>w_2</code>, the one-step and TML estimators suggest
that the average treatment effect increases by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo><mn>0.85</mn></mrow><annotation encoding="application/x-tex">\approx 0.85</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo><mn>0.82</mn></mrow><annotation encoding="application/x-tex">\approx 0.82</annotation></semantics></math>
units, respectively. Similarly for <code>w_3</code>, the one-step and
TML estimators indicate that a unit increase in this covariate leads to
an increase of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo><mn>1.95</mn></mrow><annotation encoding="application/x-tex">\approx 1.95</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo><mn>1.91</mn></mrow><annotation encoding="application/x-tex">\approx
1.91</annotation></semantics></math> in the average treatment effect,
respectively.</p>
</div>
</div>
<div class="section level3">
<h3 id="working-with-binary-outcomes">Working with Binary Outcomes<a class="anchor" aria-label="anchor" href="#working-with-binary-outcomes"></a>
</h3>
<p>In the binary outcome setting, the full-data and observed-data models
and data-generating processes are identical to those of the continuous
outcome setting, save that the outcome is binary. That means the
absolute TEM-VIP can be used as is with binary-outcome data — the only
practical difference is the choice of estimator used for the expected
outcome conditional on the treatment and covariates. With that said, a
relative TEM-VIP is generally more sensitive and informative in these
scenarios. We propose such a parameter in the following section.</p>
<p>Before that, however, we define a data-generating process with two
treatment effect modifiers:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bin_outcome_dgp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n_obs</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># pre-treatment covariates</span></span>
<span>  <span class="va">w_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_obs</span>, lambda <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="va">w_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_obs</span><span class="op">)</span></span>
<span>  <span class="va">w_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_obs</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># treatment</span></span>
<span>  <span class="va">prop_score</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span> <span class="op">+</span> <span class="fl">0.25</span> <span class="op">*</span> <span class="va">w_1</span> <span class="op">+</span> <span class="va">w_2</span> <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="va">w_3</span><span class="op">)</span></span>
<span>  <span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n_obs</span>, <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">prop_score</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># potential outcomes</span></span>
<span>  <span class="va">y_prob_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span> <span class="op">-</span> <span class="fl">3</span> <span class="op">*</span> <span class="va">w_3</span><span class="op">)</span></span>
<span>  <span class="va">y_prob_0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">w_2</span><span class="op">)</span></span>
<span>  <span class="va">y_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n_obs</span>, <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">y_prob_1</span><span class="op">)</span></span>
<span>  <span class="va">y_0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n_obs</span>, <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">y_prob_0</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># outcome</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">a</span> <span class="op">*</span> <span class="va">y_1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">a</span><span class="op">)</span> <span class="op">*</span> <span class="va">y_0</span></span>
<span></span>
<span>  <span class="co"># assemble the observations in a tibble</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    w_1 <span class="op">=</span> <span class="va">w_1</span>,</span>
<span>    w_2 <span class="op">=</span> <span class="va">w_2</span>,</span>
<span>    w_3 <span class="op">=</span> <span class="va">w_3</span>,</span>
<span>    a <span class="op">=</span> <span class="va">a</span>,</span>
<span>    y <span class="op">=</span> <span class="va">y</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Here, <code>w_2</code> and <code>w_3</code> are a treatment effect
modifier. They interact with the treatment variable, <code>a</code>.</p>
<div class="section level4">
<h4 id="relative-tem-vip">Relative TEM-VIP<a class="anchor" aria-label="anchor" href="#relative-tem-vip"></a>
</h4>
<p>The relative TEM-VIP for the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>j</mi><mtext mathvariant="normal">th</mtext></msup><annotation encoding="application/x-tex">j^\text{th}</annotation></semantics></math>
pre-treatment covariate is
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi mathvariant="normal">Γ</mi><mi>j</mi><mi>F</mi></msubsup><mo stretchy="false" form="prefix">(</mo><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub><mo stretchy="false" form="postfix">)</mo><mo>=</mo><mfrac><mrow><msub><mtext mathvariant="normal">Cov</mtext><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub></msub><mo stretchy="false" form="prefix">[</mo><mrow><mi>log</mi><mo>⁡</mo></mrow><msub><mi>𝔼</mi><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub></msub><mo stretchy="false" form="prefix">[</mo><msup><mi>Y</mi><mrow><mo stretchy="false" form="prefix">(</mo><mn>1</mn><mo stretchy="false" form="postfix">)</mo></mrow></msup><mo stretchy="false" form="prefix">|</mo><mi>W</mi><mo stretchy="false" form="postfix">]</mo><mo>−</mo><mrow><mi>log</mi><mo>⁡</mo></mrow><msub><mi>𝔼</mi><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub></msub><mo stretchy="false" form="prefix">[</mo><msup><mi>Y</mi><mrow><mo stretchy="false" form="prefix">(</mo><mn>0</mn><mo stretchy="false" form="postfix">)</mo></mrow></msup><mo stretchy="false" form="prefix">|</mo><mi>W</mi><mo stretchy="false" form="postfix">]</mo><mo>,</mo><msub><mi>W</mi><mi>j</mi></msub><mo stretchy="false" form="postfix">]</mo></mrow><mrow><msub><mi>𝕍</mi><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub></msub><mo stretchy="false" form="prefix">[</mo><msub><mi>W</mi><mi>j</mi></msub><mo stretchy="false" form="postfix">]</mo></mrow></mfrac><mspace width="0.278em"></mspace><mi>.</mi></mrow><annotation encoding="application/x-tex">
\Gamma^F_j(P_{X,0})
=\frac{\text{Cov}_{P_{X,0}}[\log\mathbb{E}_{P_{X,0}}[Y^{(1)}|W]-
  \log\mathbb{E}_{P_{X,0}}[Y^{(0)}|W], W_j]}
  {\mathbb{V}_{P_{X,0}}[W_j]} \;.
</annotation></semantics></math></p>
<p>Assuming that the expectation of the log ratio of the expected
conditional potential outcomes conditional on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>W</mi><mi>j</mi></msub><annotation encoding="application/x-tex">W_j</annotation></semantics></math>
is linear in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>W</mi><mi>j</mi></msub><annotation encoding="application/x-tex">W_j</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi mathvariant="normal">Γ</mi><mi>j</mi><mi>F</mi></msubsup><mo stretchy="false" form="prefix">(</mo><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">\Gamma^F_j(P_{X,0})</annotation></semantics></math>
is the simple linear regression coefficient obtained by regressing the
log ratio of the expected conditional potential outcomes on <span class="math inline">$W_j
- \mathbbf{E}_{P_{X,0}}[W_j]$</span>. As with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi mathvariant="normal">Ψ</mi><mi>j</mi><mi>F</mi></msubsup><mo stretchy="false" form="prefix">(</mo><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">\Psi^F_j(P_{X,0})</annotation></semantics></math>,
this parameter can be interpreted as standardized correlation
coefficient of the log ratio of expected potential outcomes and the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>j</mi><mtext mathvariant="normal">th</mtext></msup><annotation encoding="application/x-tex">j^\text{th}</annotation></semantics></math>
pre-treatment covariate.</p>
<p>We highlight that this TEM-VIP isn’t restricted to data-generating
processes with binary outcomes; it may also be used when the outcome is
non-negative, continuous or discrete random variable.</p>
<p>Again, much like
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi mathvariant="normal">Ψ</mi><mi>j</mi><mi>F</mi></msubsup><mo stretchy="false" form="prefix">(</mo><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">\Psi^F_j(P_{X,0})</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi mathvariant="normal">Γ</mi><mi>j</mi><mi>F</mi></msubsup><mo stretchy="false" form="prefix">(</mo><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">\Gamma^F_j(P_{X,0})</annotation></semantics></math>
isn’t generally ever observed since it is a parameter of the full-data
model. Under the conditions of no unmeasured confounding and in the
absence of positivity violations, however, an equivalent parameter can
be estimated from the observed-data:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">Γ</mi><mi>j</mi></msub><mo stretchy="false" form="prefix">(</mo><msub><mi>P</mi><mn>0</mn></msub><mo stretchy="false" form="postfix">)</mo><mo>=</mo><mfrac><mrow><msub><mtext mathvariant="normal">Cov</mtext><msub><mi>P</mi><mn>0</mn></msub></msub><mo stretchy="false" form="prefix">[</mo><mrow><mi>log</mi><mo>⁡</mo></mrow><msub><mi>𝔼</mi><msub><mi>P</mi><mn>0</mn></msub></msub><mo stretchy="false" form="prefix">[</mo><mi>Y</mi><mo stretchy="false" form="prefix">|</mo><mi>A</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>W</mi><mo stretchy="false" form="postfix">]</mo><mo>−</mo><mrow><mi>log</mi><mo>⁡</mo></mrow><msub><mi>𝔼</mi><msub><mi>P</mi><mn>0</mn></msub></msub><mo stretchy="false" form="prefix">[</mo><mi>Y</mi><mo stretchy="false" form="prefix">|</mo><mi>A</mi><mo>=</mo><mn>0</mn><mo>,</mo><mi>W</mi><mo stretchy="false" form="postfix">]</mo><mo>,</mo><msub><mi>W</mi><mi>j</mi></msub><mo stretchy="false" form="postfix">]</mo></mrow><mrow><msub><mi>𝕍</mi><msub><mi>P</mi><mn>0</mn></msub></msub><mo stretchy="false" form="prefix">[</mo><msub><mi>W</mi><mi>j</mi></msub><mo stretchy="false" form="postfix">]</mo></mrow></mfrac><mo>=</mo><msubsup><mi mathvariant="normal">Γ</mi><mi>j</mi><mi>F</mi></msubsup><mo stretchy="false" form="prefix">(</mo><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub><mo stretchy="false" form="postfix">)</mo><mspace width="0.278em"></mspace><mi>.</mi></mrow><annotation encoding="application/x-tex">
\Gamma_j(P_0)
=\frac{\text{Cov}_{P_0}[\log\mathbb{E}_{P_{0}}[Y|A=1,W]-
  \log\mathbb{E}_{P_0}[Y|A=0,W], W_j]}{\mathbb{V}_{P_0}[W_j]} 
= \Gamma^F_j(P_{X,0})\;.
</annotation></semantics></math></p>
<p>Nonparametric one-step and TML estimators of this parameter are
derived by <span class="citation">Boileau et al. (2025)</span> and
implemented in the <code>unicate</code> package. Just like
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">Ψ</mi><mi>j</mi></msub><mo stretchy="false" form="prefix">(</mo><msub><mi>P</mi><mn>0</mn></msub><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">\Psi_j(P_0)</annotation></semantics></math>,
inference about this parameter depends on the estimation of the
propensity score and the expected outcome conditional on treatment
indicator and covariates. These estimators are consistent if both
nuisance parameters are consistently estimated, and are asymptotically
normal if both converge to their true values at rate of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>n</mi><mrow><mi>−</mi><mn>1</mn><mi>/</mi><mn>4</mn></mrow></msup><annotation encoding="application/x-tex">n^{-1/4}</annotation></semantics></math>.
The latter permits hypothesis testing based on the Wald-type confidence
intervals. Additional details are provided by <span class="citation">Boileau et al. (2025)</span>.</p>
<p>We now apply these estimators to a random sample generated by
<code>bin_outcome_dgp()</code>. The nuisance parameters are estimated
using Random Forests implemented in <code>ranger</code> package <span class="citation">(Breiman 2001; Wright and Ziegler 2017)</span>. Note
too that these estimators are fit using cross-fitting <span class="citation">(Zheng and van der Laan 2011; Chernozhukov et al.
2017)</span>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># simulate a random sample</span></span>
<span><span class="va">sample_df</span> <span class="op">&lt;-</span> <span class="fu">bin_outcome_dgp</span><span class="op">(</span>n_obs <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># one-step estimator</span></span>
<span><span class="fu"><a href="../reference/unihtee.html">unihtee</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">sample_df</span>,</span>
<span>  confounders <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_1"</span>, <span class="st">"w_2"</span>, <span class="st">"w_3"</span><span class="op">)</span>,</span>
<span>  modifiers <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_1"</span>, <span class="st">"w_2"</span>, <span class="st">"w_3"</span><span class="op">)</span>,</span>
<span>  exposure <span class="op">=</span> <span class="st">"a"</span>,</span>
<span>  outcome <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  outcome_type <span class="op">=</span> <span class="st">"binary"</span>,</span>
<span>  effect <span class="op">=</span> <span class="st">"relative"</span>,</span>
<span>  estimator <span class="op">=</span> <span class="st">"onestep"</span>,</span>
<span>  cond_outcome_estimator <span class="op">=</span> <span class="fu">sl3</span><span class="fu">::</span><span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_ranger.html" class="external-link">Lrnr_ranger</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  prop_score_estimator <span class="op">=</span> <span class="fu">sl3</span><span class="fu">::</span><span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_ranger.html" class="external-link">Lrnr_ranger</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  cross_fit <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    modifier    estimate        se           z      p_value  ci_lower</span></span>
<span><span class="co">#&gt;      &lt;fctr&gt;       &lt;num&gt;     &lt;num&gt;       &lt;num&gt;        &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      w_3 -3.48443818 0.6479029 -5.37802562 7.530710e-08 -4.754328</span></span>
<span><span class="co">#&gt; 2:      w_2 -0.87932567 0.4091068 -2.14937904 3.160437e-02 -1.681175</span></span>
<span><span class="co">#&gt; 3:      w_1 -0.04379762 1.0908615 -0.04014957 9.679739e-01 -2.181886</span></span>
<span><span class="co">#&gt;       ci_upper  p_value_fdr</span></span>
<span><span class="co">#&gt;          &lt;num&gt;        &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: -2.21454857 2.259213e-07</span></span>
<span><span class="co">#&gt; 2: -0.07747626 4.740655e-02</span></span>
<span><span class="co">#&gt; 3:  2.09429088 9.679739e-01</span></span>
<span></span>
<span><span class="co"># TML estimator</span></span>
<span><span class="fu"><a href="../reference/unihtee.html">unihtee</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">sample_df</span>,</span>
<span>  confounders <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_1"</span>, <span class="st">"w_2"</span>, <span class="st">"w_3"</span><span class="op">)</span>,</span>
<span>  modifiers <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_1"</span>, <span class="st">"w_2"</span>, <span class="st">"w_3"</span><span class="op">)</span>,</span>
<span>  exposure <span class="op">=</span> <span class="st">"a"</span>,</span>
<span>  outcome <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  outcome_type <span class="op">=</span> <span class="st">"binary"</span>,</span>
<span>  effect <span class="op">=</span> <span class="st">"relative"</span>,</span>
<span>  estimator <span class="op">=</span> <span class="st">"tmle"</span>,</span>
<span>  cond_outcome_estimator <span class="op">=</span> <span class="fu">sl3</span><span class="fu">::</span><span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_ranger.html" class="external-link">Lrnr_ranger</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  prop_score_estimator <span class="op">=</span> <span class="fu">sl3</span><span class="fu">::</span><span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_ranger.html" class="external-link">Lrnr_ranger</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  cross_fit <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    modifier    estimate        se           z      p_value  ci_lower</span></span>
<span><span class="co">#&gt;      &lt;fctr&gt;       &lt;num&gt;     &lt;num&gt;       &lt;num&gt;        &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      w_3 -3.78448151 0.5030545 -7.52300556 5.353114e-14 -4.770468</span></span>
<span><span class="co">#&gt; 2:      w_2 -0.89070174 0.4264948 -2.08842354 3.675965e-02 -1.726632</span></span>
<span><span class="co">#&gt; 3:      w_1  0.05910131 1.0768935  0.05488129 9.562330e-01 -2.051610</span></span>
<span><span class="co">#&gt;       ci_upper  p_value_fdr</span></span>
<span><span class="co">#&gt;          &lt;num&gt;        &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: -2.79849477 1.605934e-13</span></span>
<span><span class="co">#&gt; 2: -0.05477197 5.513947e-02</span></span>
<span><span class="co">#&gt; 3:  2.16981260 9.562330e-01</span></span></code></pre></div>
<p>Both estimators correctly identify <code>w_2</code> and
<code>w_3</code> as treatment effect modifiers, as defined by the
relative TEM-VIP. The one-step estimator’s results suggest that for
every unit increase in <code>w_2</code> and <code>w_3</code>, the log
ratio of the conditional expected potential outcomes is expected to
decrease by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo><mn>0.97</mn></mrow><annotation encoding="application/x-tex">\approx
0.97</annotation></semantics></math> and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo><mn>3.15</mn></mrow><annotation encoding="application/x-tex">\approx 3.15</annotation></semantics></math>
units, respectively. For the TML estimator, the log ration of the
conditional expected outcomes is expected to decrease by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo><mn>0.90</mn></mrow><annotation encoding="application/x-tex">\approx
0.90</annotation></semantics></math> and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo><mn>3.77</mn></mrow><annotation encoding="application/x-tex">\approx 3.77</annotation></semantics></math>
for every unit increase in <code>w_2</code> and <code>w_3</code>,
respectively.</p>
</div>
</div>
<div class="section level3">
<h3 id="working-with-time-to-event-outcomes">Working with Time-to-Event Outcomes<a class="anchor" aria-label="anchor" href="#working-with-time-to-event-outcomes"></a>
</h3>
<p><code>unihtee</code> also provides functionality for estimating
TEM-VIPs for data with right-censored time-to-event outcomes. We detail
the assumed full-data and observed-data models here, then introduce an
absolute and a relative TEM-VIP in subsequent sections.</p>
<p>Consider
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
i.i.d. random vectors
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>=</mo><mo stretchy="false" form="prefix">(</mo><mi>W</mi><mo>,</mo><mi>A</mi><mo>,</mo><msup><mi>C</mi><mrow><mo stretchy="false" form="prefix">(</mo><mn>0</mn><mo stretchy="false" form="postfix">)</mo></mrow></msup><mo>,</mo><msup><mi>C</mi><mrow><mo stretchy="false" form="prefix">(</mo><mn>1</mn><mo stretchy="false" form="postfix">)</mo></mrow></msup><mo>,</mo><msup><mi>T</mi><mrow><mo stretchy="false" form="prefix">(</mo><mn>0</mn><mo stretchy="false" form="postfix">)</mo></mrow></msup><mo>,</mo><msup><mi>T</mi><mrow><mo stretchy="false" form="prefix">(</mo><mn>1</mn><mo stretchy="false" form="postfix">)</mo></mrow></msup><mo stretchy="false" form="postfix">)</mo><mo>∼</mo><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub><mo>∈</mo><msub><mi>ℳ</mi><mi>X</mi></msub></mrow><annotation encoding="application/x-tex">X = (W, A, C^{(0)}, C^{(1)}, T^{(0)},
T^{(1)}) \sim P_{X,0} \in \mathcal{M}_X</annotation></semantics></math>.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi><mo>,</mo><mi>A</mi><mo>,</mo><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub><mo>,</mo></mrow><annotation encoding="application/x-tex">W, A, P_{X,0},</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ℳ</mi><mi>X</mi></msub><annotation encoding="application/x-tex">\mathcal{M}_X</annotation></semantics></math>
are defined as in the continuous and binary outcome models.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>C</mi><mrow><mo stretchy="false" form="prefix">(</mo><mn>0</mn><mo stretchy="false" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">C^{(0)}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>C</mi><mrow><mo stretchy="false" form="prefix">(</mo><mn>1</mn><mo stretchy="false" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">C^{(1)}</annotation></semantics></math>
correspond to the censoring times that would be observed under the
control and treatment conditions, respectively. Similarly,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>T</mi><mrow><mo stretchy="false" form="prefix">(</mo><mn>0</mn><mo stretchy="false" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">T^{(0)}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>T</mi><mrow><mo stretchy="false" form="prefix">(</mo><mn>1</mn><mo stretchy="false" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">T^{(1)}</annotation></semantics></math>
are the event times that would be observed under either treatment
assignment.</p>
<p>Again,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub><annotation encoding="application/x-tex">P_{X,0}</annotation></semantics></math>
is generally unobservable. We instead have access to random observations
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo>=</mo><mo stretchy="false" form="prefix">(</mo><mi>W</mi><mo>,</mo><mi>A</mi><mo>,</mo><mi mathvariant="normal">Δ</mi><mo>,</mo><mi>T</mi><mo stretchy="false" form="postfix">)</mo><mo>∼</mo><msub><mi>P</mi><mn>0</mn></msub><mo>∈</mo><mi>ℳ</mi></mrow><annotation encoding="application/x-tex">O = (W, A, \Delta, T) \sim P_0 \in \mathcal{M}</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi mathvariant="normal">Δ</mi><annotation encoding="application/x-tex">\Delta</annotation></semantics></math>
is a censoring indicator and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo>=</mo><mi>A</mi><mo stretchy="false" form="prefix">(</mo><mi mathvariant="normal">Δ</mi><msup><mi>C</mi><mrow><mo stretchy="false" form="prefix">(</mo><mn>1</mn><mo stretchy="false" form="postfix">)</mo></mrow></msup><mo>+</mo><mo stretchy="false" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi mathvariant="normal">Δ</mi><mo stretchy="false" form="postfix">)</mo><msup><mi>T</mi><mrow><mo stretchy="false" form="prefix">(</mo><mn>1</mn><mo stretchy="false" form="postfix">)</mo></mrow></msup><mo stretchy="false" form="postfix">)</mo><mo>+</mo><mo stretchy="false" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>A</mi><mo stretchy="false" form="postfix">)</mo><mo stretchy="false" form="prefix">(</mo><mi mathvariant="normal">Δ</mi><msup><mi>C</mi><mrow><mo stretchy="false" form="prefix">(</mo><mn>0</mn><mo stretchy="false" form="postfix">)</mo></mrow></msup><mo>+</mo><mo stretchy="false" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi mathvariant="normal">Δ</mi><mo stretchy="false" form="postfix">)</mo><msup><mi>T</mi><mrow><mo stretchy="false" form="prefix">(</mo><mn>0</mn><mo stretchy="false" form="postfix">)</mo></mrow></msup><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">T = A(\Delta C^{(1)} + (1-\Delta)T^{(1)}) +
(1-A)(\Delta C^{(0)} + (1-\Delta) T^{(0)})</annotation></semantics></math>.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi><mo>,</mo><mi>A</mi><mo>,</mo><msub><mi>P</mi><mn>0</mn></msub><mo>,</mo></mrow><annotation encoding="application/x-tex">W, A, P_0,</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ℳ</mi><annotation encoding="application/x-tex">\mathcal{M}</annotation></semantics></math>
are defined as in the previous observed-data models.</p>
<p>Now, it’s worth introducing the full-data and observed-data
conditional survival functions since both TEM-VIPs introduced in this
section rely on them. The full-data survival function is defined as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>S</mi><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub></msub><mo stretchy="false" form="prefix">(</mo><mi>t</mi><mo stretchy="false" form="prefix">|</mo><mi>A</mi><mo>,</mo><mi>W</mi><mo stretchy="false" form="postfix">)</mo><mo>=</mo><msub><mi>ℙ</mi><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub></msub><mo stretchy="false" form="prefix">[</mo><msup><mi>T</mi><mrow><mo stretchy="false" form="prefix">(</mo><mi>A</mi><mo stretchy="false" form="postfix">)</mo></mrow></msup><mo>&gt;</mo><mi>t</mi><mo stretchy="false" form="prefix">|</mo><mi>W</mi><mo stretchy="false" form="postfix">]</mo></mrow><annotation encoding="application/x-tex">S_{P_{X,0}}(t|A,W) =
\mathbb{P}_{P_{X,0}}[T^{(A)} &gt; t | W]</annotation></semantics></math>.
This parameter’s observed-data counterpart is defined analogously as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>S</mi><mn>0</mn></msub><mo stretchy="false" form="prefix">(</mo><mi>t</mi><mo stretchy="false" form="prefix">|</mo><mi>A</mi><mo>,</mo><mi>W</mi><mo stretchy="false" form="postfix">)</mo><mo>=</mo><msub><mi>P</mi><msub><mi>P</mi><mn>0</mn></msub></msub><mo stretchy="false" form="prefix">[</mo><mi>T</mi><mo>&gt;</mo><mi>t</mi><mo stretchy="false" form="prefix">|</mo><mi>A</mi><mo>,</mo><mi>W</mi><mo stretchy="false" form="postfix">]</mo></mrow><annotation encoding="application/x-tex">S_0(t|A,W) = P_{P_0}[T &gt; t |A, W]</annotation></semantics></math>.</p>
<p>Finally, we define a time-to-event data-generating process with nine
equidistant time points and three potential confounders,
<code>w_1</code>, <code>w_2</code>, and <code>w_3</code>. Of these
covariates, only <code>w_1</code> is a treatment effect modifier. Note
that <code><a href="../reference/unihtee.html">unihtee()</a></code> requires a “wide” data format when working
time-to-event outcome data. That is, each observation is represented by
a single row in the data. An example is provided following this code
chunk.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define hazard functions</span></span>
<span><span class="va">cond_cens_hazard</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time</span>, <span class="va">a</span>, <span class="va">w_1</span>, <span class="va">w_2</span>, <span class="va">w_3</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="op">(</span><span class="va">time</span> <span class="op">&lt;</span> <span class="fl">9</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fl">4</span> <span class="op">+</span> <span class="fl">0.2</span> <span class="op">*</span> <span class="op">(</span><span class="va">w_1</span> <span class="op">+</span> <span class="va">w_2</span><span class="op">)</span> <span class="op">-</span> <span class="va">a</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">cond_surv_hazard</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time</span>, <span class="va">a</span>, <span class="va">w_1</span>, <span class="va">w_2</span>, <span class="va">w_3</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="op">(</span><span class="va">time</span> <span class="op">&lt;</span> <span class="fl">9</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">3</span> <span class="op">*</span> <span class="va">a</span> <span class="op">*</span> <span class="va">w_1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">time</span> <span class="op">==</span> <span class="fl">9</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># failure time simulator</span></span>
<span><span class="va">failure_time_sim</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n_obs</span>, <span class="va">a</span>, <span class="va">w_1</span>, <span class="va">w_2</span>, <span class="va">w_3</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n_obs</span><span class="op">)</span>,</span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">obs</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">failure_time</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span>      <span class="kw">for</span> <span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">prob</span> <span class="op">&lt;-</span> <span class="fu">cond_surv_hazard</span><span class="op">(</span><span class="va">t</span>, <span class="va">a</span>, <span class="va">w_1</span><span class="op">[</span><span class="va">obs</span><span class="op">]</span>, <span class="va">w_2</span><span class="op">[</span><span class="va">obs</span><span class="op">]</span>, <span class="va">w_3</span><span class="op">[</span><span class="va">obs</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="va">status</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="va">prob</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">status</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="va">failure_time</span> <span class="op">&lt;-</span> <span class="va">t</span></span>
<span>          <span class="kw">break</span></span>
<span>        <span class="op">}</span></span>
<span>      <span class="op">}</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">failure_time</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># censoring time simulator</span></span>
<span><span class="va">censor_time_sim</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n_obs</span>, <span class="va">a</span>, <span class="va">w_1</span>, <span class="va">w_2</span>, <span class="va">w_3</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n_obs</span><span class="op">)</span>,</span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">obs</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">censor_time</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span>      <span class="kw">for</span> <span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">prob</span> <span class="op">&lt;-</span> <span class="fu">cond_cens_hazard</span><span class="op">(</span><span class="va">t</span>, <span class="va">a</span>, <span class="va">w_1</span><span class="op">[</span><span class="va">obs</span><span class="op">]</span>, <span class="va">w_2</span><span class="op">[</span><span class="va">obs</span><span class="op">]</span>, <span class="va">w_3</span><span class="op">[</span><span class="va">obs</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="va">status</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="va">prob</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">status</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="va">censor_time</span> <span class="op">&lt;-</span> <span class="va">t</span></span>
<span>          <span class="kw">break</span></span>
<span>        <span class="op">}</span></span>
<span>      <span class="op">}</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">censor_time</span><span class="op">)</span><span class="op">)</span> <span class="va">censor_time</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">censor_time</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># time-to-event outcome data-generating process</span></span>
<span><span class="va">tte_outcome_dgp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n_obs</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># pre-treatment covariates</span></span>
<span>  <span class="va">w_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_obs</span><span class="op">)</span></span>
<span>  <span class="va">w_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_obs</span><span class="op">)</span></span>
<span>  <span class="va">w_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_obs</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># treatment</span></span>
<span>  <span class="va">prop_score</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span> <span class="op">-</span> <span class="va">w_1</span> <span class="op">+</span> <span class="va">w_2</span> <span class="op">-</span> <span class="va">w_3</span><span class="op">)</span></span>
<span>  <span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n_obs</span>, <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">prop_score</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># generate the failure events for t = 1 to 9</span></span>
<span>  <span class="va">failure_time_1</span> <span class="op">&lt;-</span> <span class="fu">failure_time_sim</span><span class="op">(</span><span class="va">n_obs</span>, <span class="fl">1</span>, <span class="va">w_1</span>, <span class="va">w_2</span>, <span class="va">w_3</span><span class="op">)</span></span>
<span>  <span class="va">failure_time_0</span> <span class="op">&lt;-</span> <span class="fu">failure_time_sim</span><span class="op">(</span><span class="va">n_obs</span>, <span class="fl">0</span>, <span class="va">w_1</span>, <span class="va">w_2</span>, <span class="va">w_3</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># generate the censoring events for t = 1 to 9</span></span>
<span>  <span class="va">censor_time_1</span> <span class="op">&lt;-</span> <span class="fu">censor_time_sim</span><span class="op">(</span><span class="va">n_obs</span>, <span class="fl">1</span>, <span class="va">w_1</span>, <span class="va">w_2</span>, <span class="va">w_3</span><span class="op">)</span></span>
<span>  <span class="va">censor_time_0</span> <span class="op">&lt;-</span> <span class="fu">censor_time_sim</span><span class="op">(</span><span class="va">n_obs</span>, <span class="fl">0</span>, <span class="va">w_1</span>, <span class="va">w_2</span>, <span class="va">w_3</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># compile the failure and censoring times</span></span>
<span>  <span class="va">failure_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n_obs</span><span class="op">)</span>,</span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">obs</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">a</span><span class="op">[</span><span class="va">obs</span><span class="op">]</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="va">failure_time_1</span><span class="op">[</span><span class="va">obs</span><span class="op">]</span> <span class="kw">else</span> <span class="va">failure_time_0</span><span class="op">[</span><span class="va">obs</span><span class="op">]</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">censor_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n_obs</span><span class="op">)</span>,</span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">obs</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">a</span><span class="op">[</span><span class="va">obs</span><span class="op">]</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="va">censor_time_1</span><span class="op">[</span><span class="va">obs</span><span class="op">]</span> <span class="kw">else</span> <span class="va">censor_time_0</span><span class="op">[</span><span class="va">obs</span><span class="op">]</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># determine the observed time-to-event and censoring indicator</span></span>
<span>  <span class="va">time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n_obs</span><span class="op">)</span>,</span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">obs</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">censor_time</span><span class="op">[</span><span class="va">obs</span><span class="op">]</span> <span class="op">&lt;</span> <span class="va">failure_time</span><span class="op">[</span><span class="va">obs</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">censor_time</span><span class="op">[</span><span class="va">obs</span><span class="op">]</span></span>
<span>      <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="va">failure_time</span><span class="op">[</span><span class="va">obs</span><span class="op">]</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">censoring_indicator</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n_obs</span><span class="op">)</span>,</span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">obs</span><span class="op">)</span> <span class="kw">if</span> <span class="op">(</span><span class="va">time</span><span class="op">[</span><span class="va">obs</span><span class="op">]</span> <span class="op">==</span> <span class="va">censor_time</span><span class="op">[</span><span class="va">obs</span><span class="op">]</span><span class="op">)</span> <span class="fl">1</span> <span class="kw">else</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># assemble the tibble</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    w_1 <span class="op">=</span> <span class="va">w_1</span>,</span>
<span>    w_2 <span class="op">=</span> <span class="va">w_2</span>,</span>
<span>    w_3 <span class="op">=</span> <span class="va">w_3</span>,</span>
<span>    a <span class="op">=</span> <span class="va">a</span>,</span>
<span>    time <span class="op">=</span> <span class="va">time</span>,</span>
<span>    censoring_indicator <span class="op">=</span> <span class="va">censoring_indicator</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tte_outcome_dgp</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 6</span></span></span>
<span><span class="co">#&gt;        w_1    w_2    w_3     a  time censoring_indicator</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> -<span style="color: #BB0000;">0.592</span>   0.786  0.379     1     1                   0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> -<span style="color: #BB0000;">1.31</span>    0.555  0.357     1     2                   0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> -<span style="color: #BB0000;">0.854</span>  -<span style="color: #BB0000;">1.01</span>   0.840     1     2                   0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> -<span style="color: #BB0000;">0.147</span>  -<span style="color: #BB0000;">0.317</span> -<span style="color: #BB0000;">0.293</span>     1     3                   0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  0.987  -<span style="color: #BB0000;">0.411</span>  0.701     0     5                   0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  0.056<span style="text-decoration: underline;">5</span>  0.160 -<span style="color: #BB0000;">0.446</span>     0     3                   0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  0.614  -<span style="color: #BB0000;">0.235</span> -<span style="color: #BB0000;">1.00</span>      1     6                   0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> -<span style="color: #BB0000;">1.07</span>    1.68   1.07      1     1                   0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  0.324   2.62   0.457     0     4                   0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> -<span style="color: #BB0000;">0.593</span>  -<span style="color: #BB0000;">0.905</span>  1.13      0     5                   1</span></span></code></pre></div>
<div class="section level4">
<h4 id="absolute-tem-vip-1">Absolute TEM-VIP<a class="anchor" aria-label="anchor" href="#absolute-tem-vip-1"></a>
</h4>
<p><span class="citation">Boileau et al. (2025)</span> Propose an
absolute TEM-VIP based on the difference of restricted mean survival
times at some pre-specified time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>.
This TEM-VIP is defined as
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi mathvariant="normal">Ψ</mi><mi>j</mi><mi>F</mi></msubsup><mo stretchy="false" form="prefix">(</mo><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub><mo>;</mo><mi>t</mi><mo stretchy="false" form="postfix">)</mo><mo>=</mo><mfrac><mrow><msub><mtext mathvariant="normal">Cov</mtext><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub></msub><mrow><mo stretchy="true" form="prefix">[</mo><msubsup><mo>∫</mo><mn>0</mn><mi>t</mi></msubsup><mo stretchy="false" form="prefix">{</mo><msub><mi>S</mi><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub></msub><mo stretchy="false" form="prefix">(</mo><mi>u</mi><mo stretchy="false" form="prefix">|</mo><mn>1</mn><mo>,</mo><mi>W</mi><mo stretchy="false" form="postfix">)</mo><mo>−</mo><msub><mi>S</mi><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub></msub><mo stretchy="false" form="prefix">(</mo><mi>u</mi><mo stretchy="false" form="prefix">|</mo><mn>0</mn><mo>,</mo><mi>W</mi><mo stretchy="false" form="postfix">)</mo><mo stretchy="false" form="postfix">}</mo><mi>d</mi><mi>u</mi><mo>,</mo><msub><mi>W</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow></mrow><mrow><msub><mi>𝕍</mi><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub></msub><mo stretchy="false" form="prefix">[</mo><msub><mi>W</mi><mi>j</mi></msub><mo stretchy="false" form="postfix">]</mo></mrow></mfrac><mspace width="0.278em"></mspace><mi>.</mi></mrow><annotation encoding="application/x-tex">
\Psi_j^F(P_{X,0};t) = \frac{\text{Cov}_{P_{X,0}}\left[
  \int_0^t \{ S_{P_{X,0}}(u|1, W) - S_{P_{X,0}}(u|0, W) \} du, W_j \right]}
  {\mathbb{V}_{P_{X,0}}[W_j]} \; .
</annotation></semantics></math></p>
<p>“<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi mathvariant="normal">Ψ</mi><annotation encoding="application/x-tex">\Psi</annotation></semantics></math>”
is re-used to highlight that this is an absolute TEM-VIP. As in the
continuous outcome scenario, this parameter captures the correlation
between the conditional difference in the restricted mean survival time
and the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>j</mi><mtext mathvariant="normal">th</mtext></msup><annotation encoding="application/x-tex">j^\text{th}</annotation></semantics></math>
covariate, re-normalized to be on the same scale as the outcome. Put
another way, this parameter identifies TEMs driving the largest
difference in truncated survival times across treatment conditions.</p>
<p>As before, this full-data parameter is equal to the following
observed-data parameter under the assumptions of (1) no unmeasured
confounding, (2) censoring mechanism positivity, and (3) treatment
assignment positivity:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">Ψ</mi><mi>j</mi></msub><mo stretchy="false" form="prefix">(</mo><msub><mi>P</mi><mn>0</mn></msub><mo>;</mo><mi>t</mi><mo stretchy="false" form="postfix">)</mo><mo>=</mo><mfrac><mrow><msub><mtext mathvariant="normal">Cov</mtext><msub><mi>P</mi><mn>0</mn></msub></msub><mrow><mo stretchy="true" form="prefix">[</mo><msubsup><mo>∫</mo><mn>0</mn><mi>t</mi></msubsup><mo stretchy="false" form="prefix">{</mo><msub><mi>S</mi><mn>0</mn></msub><mo stretchy="false" form="prefix">(</mo><mi>u</mi><mo stretchy="false" form="prefix">|</mo><mn>1</mn><mo>,</mo><mi>W</mi><mo stretchy="false" form="postfix">)</mo><mo>−</mo><msub><mi>S</mi><mn>0</mn></msub><mo stretchy="false" form="prefix">(</mo><mi>u</mi><mo stretchy="false" form="prefix">|</mo><mn>0</mn><mo>,</mo><mi>W</mi><mo stretchy="false" form="postfix">)</mo><mo stretchy="false" form="postfix">}</mo><mi>d</mi><mi>u</mi><mo>,</mo><msub><mi>W</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow></mrow><mrow><msub><mi>𝕍</mi><msub><mi>P</mi><mn>0</mn></msub></msub><mo stretchy="false" form="prefix">[</mo><msub><mi>W</mi><mi>j</mi></msub><mo stretchy="false" form="postfix">]</mo></mrow></mfrac><mspace width="0.278em"></mspace><mi>.</mi></mrow><annotation encoding="application/x-tex">
\Psi_j(P_0;t) = \frac{\text{Cov}_{P_0}\left[
  \int_0^t \{ S_0(u|1, W) - S_0(u|0, W) \} du, W_j \right]}
  {\mathbb{V}_{P_0}[W_j]} \; .
</annotation></semantics></math></p>
<p>As in the continuous and binary outcome scenarios, <span class="citation">Boileau et al. (2025)</span> derived two estimators of
this absolute effect parameter: a one-step estimator and a TML
estimator. Both rely on the accurate estimation of three nuisance
parameters: the conditional event hazard function, the conditional
censoring hazard function, and the propensity score. If either the
conditional event hazard function or the conditional censoring hazard
function and the propensity score are consistently estimated, then these
nonparametric estimators are consistent. Further, if all of these
nuisance parameters are converge to their true values at a rate of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>n</mi><mrow><mi>−</mi><mn>1</mn><mi>/</mi><mn>4</mn></mrow></msup><annotation encoding="application/x-tex">n^{-1/4}</annotation></semantics></math>,
then these estimators are asymptotically normally distributed. This
permits hypothesis testing through the use of Wald-type confidence
intervals. See <span class="citation">Boileau et al. (2025)</span> for
more details.</p>
<p>We now apply these estimators to a random sample from the
data-generating process defined above, choosing as target parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Ψ</mi><mo stretchy="false" form="prefix">(</mo><msub><mi>P</mi><mn>0</mn></msub><mo>;</mo><mn>8</mn><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">\Psi(P_0; 8)</annotation></semantics></math>.
LASSO regressions are used to estimate the propensity scores and
censoring hazard functions, and, as demonstration of these methods’
flexibility, estimate the failure hazard function with XGBoost <span class="citation">(T. Chen and Guestrin 2016)</span>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># simulate a random sample</span></span>
<span><span class="va">sample_df</span> <span class="op">&lt;-</span> <span class="fu">tte_outcome_dgp</span><span class="op">(</span>n_obs <span class="op">=</span> <span class="fl">250</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># one-step estimator</span></span>
<span><span class="fu"><a href="../reference/unihtee.html">unihtee</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">sample_df</span>,</span>
<span>  confounders <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_1"</span>, <span class="st">"w_2"</span>, <span class="st">"w_3"</span><span class="op">)</span>,</span>
<span>  modifiers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_1"</span>, <span class="st">"w_2"</span>, <span class="st">"w_3"</span><span class="op">)</span>,</span>
<span>  exposure <span class="op">=</span> <span class="st">"a"</span>,</span>
<span>  outcome <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>  censoring <span class="op">=</span> <span class="st">"censoring_indicator"</span>,</span>
<span>  time_cutoff <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  outcome_type <span class="op">=</span> <span class="st">"time-to-event"</span>,</span>
<span>  effect <span class="op">=</span> <span class="st">"absolute"</span>,</span>
<span>  estimator <span class="op">=</span> <span class="st">"onestep"</span>,</span>
<span>  prop_score_estimator <span class="op">=</span> <span class="fu">sl3</span><span class="fu">::</span><span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_glmnet.html" class="external-link">Lrnr_glmnet</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  failure_hazard_estimator <span class="op">=</span> <span class="fu">sl3</span><span class="fu">::</span><span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_xgboost.html" class="external-link">Lrnr_xgboost</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  censoring_hazard_estimator <span class="op">=</span> <span class="fu">sl3</span><span class="fu">::</span><span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_glmnet.html" class="external-link">Lrnr_glmnet</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    modifier    estimate        se          z   p_value   ci_lower  ci_upper</span></span>
<span><span class="co">#&gt;      &lt;fctr&gt;       &lt;num&gt;     &lt;num&gt;      &lt;num&gt;     &lt;num&gt;      &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      w_1  2.39673344 0.2823834  8.4875152 0.0000000  1.8432620 2.9502049</span></span>
<span><span class="co">#&gt; 2:      w_2 -0.14157860 0.3217762 -0.4399909 0.6599437 -0.7722599 0.4891027</span></span>
<span><span class="co">#&gt; 3:      w_3  0.08090048 0.3299970  0.2451552 0.8063363 -0.5658936 0.7276946</span></span>
<span><span class="co">#&gt;    p_value_fdr</span></span>
<span><span class="co">#&gt;          &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:   0.0000000</span></span>
<span><span class="co">#&gt; 2:   0.8063363</span></span>
<span><span class="co">#&gt; 3:   0.8063363</span></span>
<span></span>
<span><span class="co"># TML estimator</span></span>
<span><span class="fu"><a href="../reference/unihtee.html">unihtee</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">sample_df</span>,</span>
<span>  confounders <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_1"</span>, <span class="st">"w_2"</span>, <span class="st">"w_3"</span><span class="op">)</span>,</span>
<span>  modifiers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_1"</span>, <span class="st">"w_2"</span>, <span class="st">"w_3"</span><span class="op">)</span>,</span>
<span>  exposure <span class="op">=</span> <span class="st">"a"</span>,</span>
<span>  outcome <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>  censoring <span class="op">=</span> <span class="st">"censoring_indicator"</span>,</span>
<span>  time_cutoff <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  outcome_type <span class="op">=</span> <span class="st">"time-to-event"</span>,</span>
<span>  effect <span class="op">=</span> <span class="st">"absolute"</span>,</span>
<span>  estimator <span class="op">=</span> <span class="st">"tmle"</span>,</span>
<span>  prop_score_estimator <span class="op">=</span> <span class="fu">sl3</span><span class="fu">::</span><span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_glmnet.html" class="external-link">Lrnr_glmnet</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  failure_hazard_estimator <span class="op">=</span> <span class="fu">sl3</span><span class="fu">::</span><span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_xgboost.html" class="external-link">Lrnr_xgboost</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  censoring_hazard_estimator <span class="op">=</span> <span class="fu">sl3</span><span class="fu">::</span><span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_glmnet.html" class="external-link">Lrnr_glmnet</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    modifier    estimate        se           z      p_value   ci_lower  ci_upper</span></span>
<span><span class="co">#&gt;      &lt;fctr&gt;       &lt;num&gt;     &lt;num&gt;       &lt;num&gt;        &lt;num&gt;      &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      w_1  1.94534464 0.2826673  6.88209971 5.897727e-12  1.3913167 2.4993726</span></span>
<span><span class="co">#&gt; 2:      w_2  0.09930273 0.3200769  0.31024646 7.563735e-01 -0.5280480 0.7266535</span></span>
<span><span class="co">#&gt; 3:      w_3 -0.03189188 0.3300905 -0.09661556 9.230317e-01 -0.6788692 0.6150855</span></span>
<span><span class="co">#&gt;     p_value_fdr</span></span>
<span><span class="co">#&gt;           &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: 1.769318e-11</span></span>
<span><span class="co">#&gt; 2: 9.230317e-01</span></span>
<span><span class="co">#&gt; 3: 9.230317e-01</span></span></code></pre></div>
<p>These results suggest every unit increase in <code>w_1</code> results
in an increase of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo><mn>2.40</mn></mrow><annotation encoding="application/x-tex">\approx 2.40</annotation></semantics></math>
— according to the one-step estimator — or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo><mn>1.95</mn></mrow><annotation encoding="application/x-tex">\approx 1.95</annotation></semantics></math>
— according to the TML estimator — time units for the difference in mean
survival times, truncated at time eight.</p>
</div>
<div class="section level4">
<h4 id="relative-tem-vip-1">Relative TEM-VIP<a class="anchor" aria-label="anchor" href="#relative-tem-vip-1"></a>
</h4>
<p>We next consider a relative TEM-VIP for data with right-censored
time-to-event outcomes. We define this parameter as follows for the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>j</mi><mtext mathvariant="normal">th</mtext></msup><annotation encoding="application/x-tex">j^\text{th}</annotation></semantics></math>
pre-treatment covariate:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi mathvariant="normal">Γ</mi><mi>j</mi><mi>F</mi></msubsup><mo stretchy="false" form="prefix">(</mo><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub><mo>;</mo><mi>t</mi><mo stretchy="false" form="postfix">)</mo><mo>=</mo><mfrac><mrow><msub><mtext mathvariant="normal">Cov</mtext><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub></msub><mrow><mo stretchy="true" form="prefix">[</mo><mi>log</mi><msub><mi>S</mi><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub></msub><mo stretchy="false" form="prefix">(</mo><mi>t</mi><mo stretchy="false" form="prefix">|</mo><mn>1</mn><mo>,</mo><mi>W</mi><mo stretchy="false" form="postfix">)</mo><mo>−</mo><mi>log</mi><msub><mi>S</mi><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub></msub><mo stretchy="false" form="prefix">(</mo><mi>t</mi><mo stretchy="false" form="prefix">|</mo><mn>0</mn><mo>,</mo><mi>W</mi><mo stretchy="false" form="postfix">)</mo><mo>,</mo><msub><mi>W</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow></mrow><mrow><msub><mi>𝕍</mi><msub><mi>P</mi><mrow><mi>X</mi><mo>,</mo><mn>0</mn></mrow></msub></msub><mo stretchy="false" form="prefix">[</mo><msub><mi>W</mi><mi>j</mi></msub><mo stretchy="false" form="postfix">]</mo></mrow></mfrac><mspace width="0.278em"></mspace><mi>.</mi></mrow><annotation encoding="application/x-tex">
\Gamma_j^F(P_{X,0};t) = \frac{\text{Cov}_{P_{X,0}}\left[
  \log S_{P_{X,0}}(t|1, W) - \log S_{P_{X,0}}(t|0, W), W_j\right]}
  {\mathbb{V}_{P_{X,0}}[W_j]} \; .
</annotation></semantics></math></p>
<p>For some pre-specified time point
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>,
this TEM-VIP represents the standardized correlation coefficient of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>W</mi><mi>j</mi></msub><annotation encoding="application/x-tex">W_j</annotation></semantics></math>
and the log ratio of conditional survival times under each treatment
condition. As with
“<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi mathvariant="normal">Ψ</mi><annotation encoding="application/x-tex">\Psi</annotation></semantics></math>”,
we re-use
“<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi mathvariant="normal">Γ</mi><annotation encoding="application/x-tex">\Gamma</annotation></semantics></math>”
to highlight that this is a relative effect parameter. Its observed-data
counterpart is given by
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi mathvariant="normal">Γ</mi><mi>j</mi><mi>F</mi></msubsup><mo stretchy="false" form="prefix">(</mo><msub><mi>P</mi><mn>0</mn></msub><mo>;</mo><mi>t</mi><mo stretchy="false" form="postfix">)</mo><mo>=</mo><mfrac><mrow><msub><mtext mathvariant="normal">Cov</mtext><msub><mi>P</mi><mn>0</mn></msub></msub><mrow><mo stretchy="true" form="prefix">[</mo><mi>log</mi><msub><mi>S</mi><mn>0</mn></msub><mo stretchy="false" form="prefix">(</mo><mi>t</mi><mo stretchy="false" form="prefix">|</mo><mn>1</mn><mo>,</mo><mi>W</mi><mo stretchy="false" form="postfix">)</mo><mo>−</mo><mi>log</mi><msub><mi>S</mi><mn>0</mn></msub><mo stretchy="false" form="prefix">(</mo><mi>t</mi><mo stretchy="false" form="prefix">|</mo><mn>0</mn><mo>,</mo><mi>W</mi><mo stretchy="false" form="postfix">)</mo><mo>,</mo><msub><mi>W</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow></mrow><mrow><msub><mi>𝕍</mi><msub><mi>P</mi><mn>0</mn></msub></msub><mo stretchy="false" form="prefix">[</mo><msub><mi>W</mi><mi>j</mi></msub><mo stretchy="false" form="postfix">]</mo></mrow></mfrac><mspace width="0.278em"></mspace><mo>,</mo></mrow><annotation encoding="application/x-tex">
\Gamma_j^F(P_0;t) = \frac{\text{Cov}_{P_0}\left[
  \log S_0(t|1, W) - \log S_0(t|0, W), W_j\right]}
  {\mathbb{V}_{P_0}[W_j]} \; ,
</annotation></semantics></math> again assuming that there is no
unmeasured confounding and that there are no positivity violations of
the censoring or treatment assignment mechanisms.</p>
<p><span class="citation">Boileau et al. (2025)</span> derived one-step
and TML estimators of this parameter, again requiring the estimation of
three nuisance parameters: the propensity score and the conditional
failure and censoring event hazards. These one-step and TML estimators
are consistent when all nuisance parameters are estimated consistently,
and are asymptotically linear when these nuisance parameters converge to
their true values at a fast-enough rate <span class="citation">(Boileau
et al. 2025)</span>.</p>
<p>We apply the nonparametric estimators of <span class="citation">Boileau et al. (2025)</span> to a random sample
generated by <code>tte_outcome_dgp()</code>, taking as target of
inference
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">Γ</mi><mi>j</mi></msub><mo stretchy="false" form="prefix">(</mo><msub><mi>P</mi><mn>0</mn></msub><mo>;</mo><mn>5</mn><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">\Gamma_j(P_0; 5)</annotation></semantics></math>.
The nuisance parameters are estimated using the same strategy employed
in prior absolute TEM-VIP example.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># simulate a random sample</span></span>
<span><span class="va">sample_df</span> <span class="op">&lt;-</span> <span class="fu">tte_outcome_dgp</span><span class="op">(</span>n_obs <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># one-step estimator</span></span>
<span><span class="fu"><a href="../reference/unihtee.html">unihtee</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">sample_df</span>,</span>
<span>  confounders <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_1"</span>, <span class="st">"w_2"</span>, <span class="st">"w_3"</span><span class="op">)</span>,</span>
<span>  modifiers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_1"</span>, <span class="st">"w_2"</span>, <span class="st">"w_3"</span><span class="op">)</span>,</span>
<span>  exposure <span class="op">=</span> <span class="st">"a"</span>,</span>
<span>  outcome <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>  censoring <span class="op">=</span> <span class="st">"censoring_indicator"</span>,</span>
<span>  time_cutoff <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  outcome_type <span class="op">=</span> <span class="st">"time-to-event"</span>,</span>
<span>  effect <span class="op">=</span> <span class="st">"relative"</span>,</span>
<span>  estimator <span class="op">=</span> <span class="st">"onestep"</span>,</span>
<span>  prop_score_estimator <span class="op">=</span> <span class="fu">sl3</span><span class="fu">::</span><span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_glmnet.html" class="external-link">Lrnr_glmnet</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  failure_hazard_estimator <span class="op">=</span> <span class="fu">sl3</span><span class="fu">::</span><span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_xgboost.html" class="external-link">Lrnr_xgboost</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  censoring_hazard_estimator <span class="op">=</span> <span class="fu">sl3</span><span class="fu">::</span><span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_glmnet.html" class="external-link">Lrnr_glmnet</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  cross_fit <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    modifier  estimate        se         z   p_value  ci_lower ci_upper</span></span>
<span><span class="co">#&gt;      &lt;fctr&gt;     &lt;num&gt;     &lt;num&gt;     &lt;num&gt;     &lt;num&gt;     &lt;num&gt;    &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      w_1 3.1304788 0.3629837 8.6242960 0.0000000  2.419031 3.841927</span></span>
<span><span class="co">#&gt; 2:      w_3 0.8748264 0.9267492 0.9439732 0.3451833 -0.941602 2.691255</span></span>
<span><span class="co">#&gt; 3:      w_2 1.6169328 1.7992532 0.8986688 0.3688291 -1.909604 5.143469</span></span>
<span><span class="co">#&gt;    p_value_fdr</span></span>
<span><span class="co">#&gt;          &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:   0.0000000</span></span>
<span><span class="co">#&gt; 2:   0.3688291</span></span>
<span><span class="co">#&gt; 3:   0.3688291</span></span>
<span></span>
<span><span class="co"># TML estimator</span></span>
<span><span class="fu"><a href="../reference/unihtee.html">unihtee</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">sample_df</span>,</span>
<span>  confounders <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_1"</span>, <span class="st">"w_2"</span>, <span class="st">"w_3"</span><span class="op">)</span>,</span>
<span>  modifiers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_1"</span>, <span class="st">"w_2"</span>, <span class="st">"w_3"</span><span class="op">)</span>,</span>
<span>  exposure <span class="op">=</span> <span class="st">"a"</span>,</span>
<span>  outcome <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>  censoring <span class="op">=</span> <span class="st">"censoring_indicator"</span>,</span>
<span>  time_cutoff <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  outcome_type <span class="op">=</span> <span class="st">"time-to-event"</span>,</span>
<span>  effect <span class="op">=</span> <span class="st">"relative"</span>,</span>
<span>  estimator <span class="op">=</span> <span class="st">"tmle"</span>,</span>
<span>  prop_score_estimator <span class="op">=</span> <span class="fu">sl3</span><span class="fu">::</span><span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_glmnet.html" class="external-link">Lrnr_glmnet</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  failure_hazard_estimator <span class="op">=</span> <span class="fu">sl3</span><span class="fu">::</span><span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_xgboost.html" class="external-link">Lrnr_xgboost</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  censoring_hazard_estimator <span class="op">=</span> <span class="fu">sl3</span><span class="fu">::</span><span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_glmnet.html" class="external-link">Lrnr_glmnet</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  cross_fit <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    modifier    estimate        se           z      p_value  ci_lower ci_upper</span></span>
<span><span class="co">#&gt;      &lt;fctr&gt;       &lt;num&gt;     &lt;num&gt;       &lt;num&gt;        &lt;num&gt;     &lt;num&gt;    &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      w_1  3.10042980 0.7241641  4.28139139 1.857284e-05  1.681068 4.519791</span></span>
<span><span class="co">#&gt; 2:      w_3 -0.02600101 0.6190648 -0.04200046 9.664983e-01 -1.239368 1.187366</span></span>
<span><span class="co">#&gt; 3:      w_2  0.01953589 1.7145968  0.01139387 9.909092e-01 -3.341074 3.380146</span></span>
<span><span class="co">#&gt;     p_value_fdr</span></span>
<span><span class="co">#&gt;           &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: 5.571851e-05</span></span>
<span><span class="co">#&gt; 2: 9.909092e-01</span></span>
<span><span class="co">#&gt; 3: 9.909092e-01</span></span></code></pre></div>
<p>Again, both the one-step and TML estimators successfully discern the
TEM from the other potential TEMs when using a false discovery rate
cutoff of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">5\%</annotation></semantics></math>.
These results indicate that a unit increase in <code>w_1</code> results
in an increase of the log ratio of conditional survivals equal to either
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo><mn>3.13</mn></mrow><annotation encoding="application/x-tex">\approx 3.13</annotation></semantics></math>
or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo><mn>3.10</mn></mrow><annotation encoding="application/x-tex">\approx 3.10</annotation></semantics></math>,
depending on whether one uses the one-step estimator or the TML
estimator.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="additional-features-and-notes">Additional Features and Notes<a class="anchor" aria-label="anchor" href="#additional-features-and-notes"></a>
</h2>
<div class="section level3">
<h3 id="working-with-randomized-experiment-data">Working with Randomized Experiment Data<a class="anchor" aria-label="anchor" href="#working-with-randomized-experiment-data"></a>
</h3>
<p>While <code>unihtee</code>’s estimators are applied to (simulated)
observational data in the previous section’s examples, they are also
suitable for data generated by randomized experiments. The propensity
scores used to randomize observations should be saved data object passed
to <code><a href="../reference/unihtee.html">unihtee()</a></code>, and the name of the variable containing these
scores should be indicated in the <code>propensity_score_values</code>
argument.</p>
<p>Providing the known propensity scores to the absolute TEM-VIP
estimators produces some desirable results. In the continuous and binary
outcome settings, providing known treatment assignment probabilities
guarantees that the estimators are asymptotically linear, even when the
expected conditional outcome estimator is misspecified. When the outcome
is a right-censored time-to-event variable, asymptotic normality of the
estimators is guaranteed so long as the conditional censoring hazard is
estimated consistently at a rate of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>n</mi><mrow><mi>−</mi><mn>1</mn><mi>/</mi><mn>4</mn></mrow></msup><annotation encoding="application/x-tex">n^{-1/4}</annotation></semantics></math>.
Additional details and discussions are provided in <span class="citation">Boileau et al. (2022)</span> and <span class="citation">Boileau et al. (2025)</span>.</p>
</div>
<div class="section level3">
<h3 id="cross-fitting">Cross-Fitting<a class="anchor" aria-label="anchor" href="#cross-fitting"></a>
</h3>
<p>Cross-fitting, popularized by <span class="citation">Zheng and van
der Laan (2011)</span> and <span class="citation">Chernozhukov et al.
(2017)</span>, uses cross-validation to fit the nuisance parameters and
estimate the target parameter. Doing so relaxes an assumption required
for asymptotic normality of the one-step and TML estimators implemented
in the <code>unihtee</code> package <span class="citation">(Boileau et
al. 2025)</span>. This technique is also known to improve these
estimators finite-sample properties, such as reducing their false
discovery rate (see, for example, <span class="citation">Hejazi et
al.</span>).</p>
<p>Users may employ the cross-fitted version of any estimator
implemented in <code>unihtee</code> by setting <code><a href="../reference/unihtee.html">unihtee()</a></code>’s
<code>cross_fit</code> argument to <code>TRUE</code>. Only K-fold
cross-validation is currently supported. The number of folds defaults to
five, though this can be modified using the <code>cross_fit_folds</code>
argument. Examples are provided in the binary outcome and time-to-event
outcome relative TEM-VIP sections above, as well as in the subsection on
Super Learners that follows.</p>
</div>
<div class="section level3">
<h3 id="sl3-integration-using-super-learners">
<code>sl3</code> Integration: Using Super Learners<a class="anchor" aria-label="anchor" href="#sl3-integration-using-super-learners"></a>
</h3>
<p><code>unihtee</code> uses the estimators implemented in the
<code>sl3</code> <span class="citation">(Coyle et al. 2021)</span> to
estimate nuisance parameters. While individual estimators may be used,
as is done in the examples above, <code>sl3</code>’s main contribution
are facilities for constructing Super Learners <span class="citation">(Laan, Polley, and Hubbard 2007)</span>. Super Learners
are ensemble algorithms, meaning they are the convex combination of
individual supervised learning algorithms. These individual algorithms
are combined on the basis of a user-defined risk, and this combination
is asymptotically optimal with respect to said risk under minimal
conditions about the data-generating process. A complete review on Super
Learners and <code>sl3</code> is outside the scope of this vignette. We
invite the interested reader to the tutorials available on the
<code>sl3</code> package’s <a href="https://tlverse.org/sl3/" class="external-link">website</a> and in Chapter 6 of the <a href="https://tlverse.org/tlverse-handbook/sl3.html" class="external-link"><code>tlverse</code>
handbook</a> <span class="citation">(Phillips 2023)</span>.</p>
<p>Employing Super Learners to estimate nuisance parameters decreases
the risk of model-misspecification — assuming, of course, that a diverse
collection individual learning algorithms is considered. In turn, there
is an increased likelihood that the resulting one-step and TML
estimators are asymptotically normal.</p>
<p>We revisit our continuous outcome example, this time using Super
Learners to estimate the propensity score and the conditional expected
outcomes. Both Super Learners are composed of penalized GLMs,
multivariate adaptive regression splines <span class="citation">(Friedman 1991)</span>, and Random Forests. The
propensity score’s Super Learner uses the negative log likelihood loss
to form the convex combination of individual learning algorithms, while
the conditional expected outcomes’ uses the squared error loss.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># simulate a random sample</span></span>
<span><span class="va">sample_df</span> <span class="op">&lt;-</span> <span class="fu">cont_outcome_dgp</span><span class="op">(</span>n_obs <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># define the Super Learner for the propensity score</span></span>
<span><span class="va">sl_bin</span> <span class="op">&lt;-</span> <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_sl.html" class="external-link">Lrnr_sl</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  learners <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_glmnet.html" class="external-link">Lrnr_glmnet</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>family <span class="op">=</span> <span class="st">"binomial"</span>, alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>    <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_glmnet.html" class="external-link">Lrnr_glmnet</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>family <span class="op">=</span> <span class="st">"binomial"</span>, alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>    <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_glmnet.html" class="external-link">Lrnr_glmnet</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>family <span class="op">=</span> <span class="st">"binomial"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>    <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_earth.html" class="external-link">Lrnr_earth</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>glm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_ranger.html" class="external-link">Lrnr_ranger</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  metalearner <span class="op">=</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/Lrnr_base.html" class="external-link">make_learner</a></span><span class="op">(</span></span>
<span>    <span class="va">Lrnr_solnp</span>, <span class="va">metalearner_logistic_binomial</span>, <span class="va">loss_loglik_binomial</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># define the Super Learner for the conditional expected outcomes</span></span>
<span><span class="va">sl_cont</span> <span class="op">&lt;-</span> <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_sl.html" class="external-link">Lrnr_sl</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  learners <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu">sl3</span><span class="fu">::</span><span class="fu"><a href="https://tlverse.org/sl3/reference/Lrnr_base.html" class="external-link">make_learner</a></span><span class="op">(</span></span>
<span>      <span class="fu">sl3</span><span class="fu">::</span><span class="va"><a href="https://tlverse.org/sl3/reference/Pipeline.html" class="external-link">Pipeline</a></span>,</span>
<span>      <span class="fu">sl3</span><span class="fu">::</span><span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_define_interactions.html" class="external-link">Lrnr_define_interactions</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_1"</span>, <span class="st">"a"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_2"</span>, <span class="st">"a"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_3"</span>, <span class="st">"a"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_4"</span>, <span class="st">"a"</span><span class="op">)</span>,</span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_5"</span>, <span class="st">"a"</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      <span class="fu">sl3</span><span class="fu">::</span><span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_glmnet.html" class="external-link">Lrnr_glmnet</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu">sl3</span><span class="fu">::</span><span class="fu"><a href="https://tlverse.org/sl3/reference/Lrnr_base.html" class="external-link">make_learner</a></span><span class="op">(</span></span>
<span>      <span class="fu">sl3</span><span class="fu">::</span><span class="va"><a href="https://tlverse.org/sl3/reference/Pipeline.html" class="external-link">Pipeline</a></span>,</span>
<span>      <span class="fu">sl3</span><span class="fu">::</span><span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_define_interactions.html" class="external-link">Lrnr_define_interactions</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_1"</span>, <span class="st">"a"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_2"</span>, <span class="st">"a"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_3"</span>, <span class="st">"a"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_4"</span>, <span class="st">"a"</span><span class="op">)</span>,</span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_5"</span>, <span class="st">"a"</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      <span class="fu">sl3</span><span class="fu">::</span><span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_glmnet.html" class="external-link">Lrnr_glmnet</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu">sl3</span><span class="fu">::</span><span class="fu"><a href="https://tlverse.org/sl3/reference/Lrnr_base.html" class="external-link">make_learner</a></span><span class="op">(</span></span>
<span>      <span class="fu">sl3</span><span class="fu">::</span><span class="va"><a href="https://tlverse.org/sl3/reference/Pipeline.html" class="external-link">Pipeline</a></span>,</span>
<span>      <span class="fu">sl3</span><span class="fu">::</span><span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_define_interactions.html" class="external-link">Lrnr_define_interactions</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_1"</span>, <span class="st">"a"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_2"</span>, <span class="st">"a"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_3"</span>, <span class="st">"a"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_4"</span>, <span class="st">"a"</span><span class="op">)</span>,</span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_5"</span>, <span class="st">"a"</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      <span class="fu">sl3</span><span class="fu">::</span><span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_glmnet.html" class="external-link">Lrnr_glmnet</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_earth.html" class="external-link">Lrnr_earth</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>degree <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_earth.html" class="external-link">Lrnr_earth</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>glm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"gaussian"</span><span class="op">)</span>, degree <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>    <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_ranger.html" class="external-link">Lrnr_ranger</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  metalearner <span class="op">=</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/Lrnr_base.html" class="external-link">make_learner</a></span><span class="op">(</span></span>
<span>    <span class="va">Lrnr_solnp</span>, <span class="va">metalearner_linear</span>, <span class="va">loss_squared_error</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># one-step estimator</span></span>
<span><span class="fu"><a href="../reference/unihtee.html">unihtee</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">sample_df</span>,</span>
<span>  confounders <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_1"</span>, <span class="st">"w_2"</span>, <span class="st">"w_3"</span>, <span class="st">"w_4"</span>, <span class="st">"w_5"</span><span class="op">)</span>,</span>
<span>  modifiers <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_1"</span>, <span class="st">"w_2"</span>, <span class="st">"w_3"</span>, <span class="st">"w_4"</span>, <span class="st">"w_5"</span><span class="op">)</span>,</span>
<span>  exposure <span class="op">=</span> <span class="st">"a"</span>,</span>
<span>  outcome <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  outcome_type <span class="op">=</span> <span class="st">"continuous"</span>,</span>
<span>  effect <span class="op">=</span> <span class="st">"absolute"</span>,</span>
<span>  estimator <span class="op">=</span> <span class="st">"onestep"</span>,</span>
<span>  cond_outcome_estimator <span class="op">=</span> <span class="va">sl_cont</span>,</span>
<span>  prop_score_estimator <span class="op">=</span> <span class="va">sl_bin</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    modifier     estimate        se           z   p_value    ci_lower  ci_upper</span></span>
<span><span class="co">#&gt;      &lt;fctr&gt;        &lt;num&gt;     &lt;num&gt;       &lt;num&gt;     &lt;num&gt;       &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      w_2  1.075841687 0.1118589  9.61784353 0.0000000  0.85659818 1.2950852</span></span>
<span><span class="co">#&gt; 2:      w_3  2.024303055 0.1330007 15.22024499 0.0000000  1.76362171 2.2849844</span></span>
<span><span class="co">#&gt; 3:      w_1  0.161787857 0.1188020  1.36182826 0.1732521 -0.07106397 0.3946397</span></span>
<span><span class="co">#&gt; 4:      w_5  0.007153675 0.1212798  0.05898488 0.9529641 -0.23055475 0.2448621</span></span>
<span><span class="co">#&gt; 5:      w_4 -0.002416209 0.1198597 -0.02015864 0.9839168 -0.23734126 0.2325088</span></span>
<span><span class="co">#&gt;    p_value_fdr</span></span>
<span><span class="co">#&gt;          &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:   0.0000000</span></span>
<span><span class="co">#&gt; 2:   0.0000000</span></span>
<span><span class="co">#&gt; 3:   0.2887535</span></span>
<span><span class="co">#&gt; 4:   0.9839168</span></span>
<span><span class="co">#&gt; 5:   0.9839168</span></span>
<span></span>
<span><span class="co"># TML estimator</span></span>
<span><span class="fu"><a href="../reference/unihtee.html">unihtee</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">sample_df</span>,</span>
<span>  confounders <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_1"</span>, <span class="st">"w_2"</span>, <span class="st">"w_3"</span>, <span class="st">"w_4"</span>, <span class="st">"w_5"</span><span class="op">)</span>,</span>
<span>  modifiers <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_1"</span>, <span class="st">"w_2"</span>, <span class="st">"w_3"</span>, <span class="st">"w_4"</span>, <span class="st">"w_5"</span><span class="op">)</span>,</span>
<span>  exposure <span class="op">=</span> <span class="st">"a"</span>,</span>
<span>  outcome <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  outcome_type <span class="op">=</span> <span class="st">"continuous"</span>,</span>
<span>  effect <span class="op">=</span> <span class="st">"absolute"</span>,</span>
<span>  estimator <span class="op">=</span> <span class="st">"tmle"</span>,</span>
<span>  cond_outcome_estimator <span class="op">=</span> <span class="va">sl_cont</span>,</span>
<span>  prop_score_estimator <span class="op">=</span> <span class="va">sl_bin</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    modifier     estimate        se           z   p_value    ci_lower  ci_upper</span></span>
<span><span class="co">#&gt;      &lt;fctr&gt;        &lt;num&gt;     &lt;num&gt;       &lt;num&gt;     &lt;num&gt;       &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      w_2  1.052130930 0.1119089  9.40166999 0.0000000  0.83278941 1.2714725</span></span>
<span><span class="co">#&gt; 2:      w_3  1.999026617 0.1330143 15.02865830 0.0000000  1.73831857 2.2597347</span></span>
<span><span class="co">#&gt; 3:      w_1  0.156419220 0.1188069  1.31658412 0.1879781 -0.07644222 0.3892807</span></span>
<span><span class="co">#&gt; 4:      w_4  0.006275685 0.1199683  0.05231119 0.9582807 -0.22886223 0.2414136</span></span>
<span><span class="co">#&gt; 5:      w_5 -0.002993851 0.1213515 -0.02467091 0.9803175 -0.24084270 0.2348550</span></span>
<span><span class="co">#&gt;    p_value_fdr</span></span>
<span><span class="co">#&gt;          &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:   0.0000000</span></span>
<span><span class="co">#&gt; 2:   0.0000000</span></span>
<span><span class="co">#&gt; 3:   0.3132968</span></span>
<span><span class="co">#&gt; 4:   0.9803175</span></span>
<span><span class="co">#&gt; 5:   0.9803175</span></span></code></pre></div>
<p>Though this procedure is more robust, the resulting estimates and
hypothesis tests are similar to those of the previous continuous
outcome, absolute TEM-VIP example.</p>
</div>
</div>
<div class="section level2">
<h2 id="visualizing-tem-vip-estimates">Visualizing TEM-VIP Estimates<a class="anchor" aria-label="anchor" href="#visualizing-tem-vip-estimates"></a>
</h2>
<p>The <code>unihtee</code> package provides functionality for
visualizing pre-treatment covariates’ TEM-VIP estimates. The resulting
plots can help with the interpretation of the TEM-VIP parameter.</p>
<p>Consider the following data-generating process:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cont_outcome_dgp_2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n_obs</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># pre-treatment covariates</span></span>
<span>  <span class="va">w_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_obs</span><span class="op">)</span></span>
<span>  <span class="va">w_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_obs</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">w_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_obs</span><span class="op">)</span></span>
<span>  <span class="va">w_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_obs</span><span class="op">)</span></span>
<span>  <span class="va">w_5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_obs</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># treatment</span></span>
<span>  <span class="va">prop_score</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">w_1</span> <span class="op">+</span> <span class="va">w_2</span><span class="op">)</span></span>
<span>  <span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n_obs</span>, <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">prop_score</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># potential outcomes</span></span>
<span>  <span class="va">y_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_obs</span>, mean <span class="op">=</span> <span class="va">w_1</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">w_2</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">w_3</span> <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="va">a</span>, sd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span>  <span class="va">y_0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_obs</span>, mean <span class="op">=</span> <span class="va">w_1</span> <span class="op">+</span> <span class="va">w_2</span>, sd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># outcome</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">a</span> <span class="op">*</span> <span class="va">y_1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">a</span><span class="op">)</span> <span class="op">*</span> <span class="va">y_0</span></span>
<span></span>
<span>  <span class="co"># assemble the observations in a tibble</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    w_1 <span class="op">=</span> <span class="va">w_1</span>,</span>
<span>    w_2 <span class="op">=</span> <span class="va">w_2</span>,</span>
<span>    w_3 <span class="op">=</span> <span class="va">w_3</span>,</span>
<span>    w_4 <span class="op">=</span> <span class="va">w_4</span>,</span>
<span>    w_5 <span class="op">=</span> <span class="va">w_5</span>,</span>
<span>    a <span class="op">=</span> <span class="va">a</span>,</span>
<span>    y <span class="op">=</span> <span class="va">y</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This data-generating process is similar to the previously introduced
data-generating process for continuous outcomes, though it contains two
binary pre-treatment covariates <code>w_2</code> and <code>w_5</code> in
addition to the continuous pre-treatment covariates <code>w_1</code>,
<code>w_3</code>, and <code>w_4</code>.</p>
<p>We can visualize the TEM-VIP estimate of, for example,
<code>w_3</code> as follows:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># simulate a random sample from above data-generating process</span></span>
<span><span class="va">sample_df</span> <span class="op">&lt;-</span> <span class="fu">cont_outcome_dgp_2</span><span class="op">(</span>n_obs <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># TML estimator</span></span>
<span><span class="va">unihtee_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/unihtee.html">unihtee</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">sample_df</span>,</span>
<span>  confounders <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_1"</span>, <span class="st">"w_2"</span>, <span class="st">"w_3"</span>, <span class="st">"w_4"</span>, <span class="st">"w_5"</span><span class="op">)</span>,</span>
<span>  modifiers <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_1"</span>, <span class="st">"w_2"</span>, <span class="st">"w_3"</span>, <span class="st">"w_4"</span>, <span class="st">"w_5"</span><span class="op">)</span>,</span>
<span>  exposure <span class="op">=</span> <span class="st">"a"</span>,</span>
<span>  outcome <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  outcome_type <span class="op">=</span> <span class="st">"continuous"</span>,</span>
<span>  effect <span class="op">=</span> <span class="st">"absolute"</span>,</span>
<span>  estimator <span class="op">=</span> <span class="st">"tmle"</span>,</span>
<span>  cond_outcome_estimator <span class="op">=</span> <span class="va">sl_cont</span>,</span>
<span>  prop_score_estimator <span class="op">=</span> <span class="va">sl_bin</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># visualize w_3's TEM-VIP estimate</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">unihtee_output</span>, modifier_name <span class="op">=</span> <span class="st">"w_3"</span>, print_interpretation <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="using-unihtee_files/figure-html/plot-cont-tem-vip-estimate-1.png" width="700"></p>
<p>The resulting plot is constructed by plotting the simple linear
regression of the conditional average causal effect — in this scenario,
the conditional average treatment effect — regressed on
<code>w_3</code>. As previously stated, the TEM-VIP for <code>w_3</code>
corresponds to the slope of this black line. The average treatment
effect estimate is given by the dotted red line.</p>
<p>The visualization for binary pre-treatment covariates is different.
Consider the plot of <code>w_2</code>’s TEM-VIP estimate:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># visualize w_2's TEM-VIP estimate</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">unihtee_output</span>, modifier_name <span class="op">=</span> <span class="st">"w_2"</span>, print_interpretation <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="using-unihtee_files/figure-html/plot-bin-tem-vip-estimate-1.png" width="700"></p>
<p>Here, the <code>w_2</code>’s TEM-VIP estimate corresponds to the
vertical distance between the two black points in the above plot. Again,
the average treatment effect estimate is given by the dotted red
line.</p>
</div>
<div class="section level2">
<h2 id="session-information">Session information<a class="anchor" aria-label="anchor" href="#session-information"></a>
</h2>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.5.0 (2025-04-11)</span></span>
<span><span class="co">#&gt; Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">#&gt; Running under: Ubuntu 24.04.2 LTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.26.so;  LAPACK version 3.12.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              </span></span>
<span><span class="co">#&gt;  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    </span></span>
<span><span class="co">#&gt;  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   </span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 </span></span>
<span><span class="co">#&gt;  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span></span>
<span><span class="co">#&gt; [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: Etc/UTC</span></span>
<span><span class="co">#&gt; tzcode source: system (glibc)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt;  [1] unihtee_0.0.3    earth_5.3.4      plotmo_3.6.4     plotrix_3.8-4   </span></span>
<span><span class="co">#&gt;  [5] Formula_1.2-5    ranger_0.17.0    xgboost_1.7.11.1 glmnet_4.1-9    </span></span>
<span><span class="co">#&gt;  [9] Matrix_1.7-3     Rsolnp_2.0.1     sl3_1.4.5        dplyr_1.1.4     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;   [1] Rdpack_2.6.4         delayed_0.5.0        pROC_1.18.5         </span></span>
<span><span class="co">#&gt;   [4] rlang_1.1.6          magrittr_2.0.3       compiler_4.5.0      </span></span>
<span><span class="co">#&gt;   [7] systemfonts_1.2.3    vctrs_0.6.5          reshape2_1.4.4      </span></span>
<span><span class="co">#&gt;  [10] stringr_1.5.1        pkgconfig_2.0.3      shape_1.4.6.1       </span></span>
<span><span class="co">#&gt;  [13] crayon_1.5.3         fastmap_1.2.0        backports_1.5.0     </span></span>
<span><span class="co">#&gt;  [16] labeling_0.4.3       rmarkdown_2.29       prodlim_2025.04.28  </span></span>
<span><span class="co">#&gt;  [19] ragg_1.4.0           purrr_1.0.4          xfun_0.52           </span></span>
<span><span class="co">#&gt;  [22] cachem_1.1.0         jsonlite_2.0.0       progress_1.2.3      </span></span>
<span><span class="co">#&gt;  [25] recipes_1.3.1        uuid_1.2-1           parallel_4.5.0      </span></span>
<span><span class="co">#&gt;  [28] prettyunits_1.2.0    R6_2.6.1             bslib_0.9.0         </span></span>
<span><span class="co">#&gt;  [31] stringi_1.8.7        RColorBrewer_1.1-3   parallelly_1.45.0   </span></span>
<span><span class="co">#&gt;  [34] rpart_4.1.24         lubridate_1.9.4      jquerylib_0.1.4     </span></span>
<span><span class="co">#&gt;  [37] numDeriv_2016.8-1.1  Rcpp_1.1.0           assertthat_0.2.1    </span></span>
<span><span class="co">#&gt;  [40] iterators_1.0.14     knitr_1.50           future.apply_1.20.0 </span></span>
<span><span class="co">#&gt;  [43] R.utils_2.13.0       splines_4.5.0        nnet_7.3-20         </span></span>
<span><span class="co">#&gt;  [46] igraph_2.1.4         timechange_0.3.0     tidyselect_1.2.1    </span></span>
<span><span class="co">#&gt;  [49] dichromat_2.0-0.1    abind_1.4-8          yaml_2.3.10         </span></span>
<span><span class="co">#&gt;  [52] timeDate_4041.110    codetools_0.2-20     listenv_0.9.1       </span></span>
<span><span class="co">#&gt;  [55] lattice_0.22-7       tibble_3.3.0         plyr_1.8.9          </span></span>
<span><span class="co">#&gt;  [58] withr_3.0.2          ROCR_1.0-11          evaluate_1.0.4      </span></span>
<span><span class="co">#&gt;  [61] future_1.58.0        desc_1.4.3           survival_3.8-3      </span></span>
<span><span class="co">#&gt;  [64] pillar_1.11.0        checkmate_2.3.2      foreach_1.5.2       </span></span>
<span><span class="co">#&gt;  [67] stats4_4.5.0         generics_0.1.4       truncnorm_1.0-9     </span></span>
<span><span class="co">#&gt;  [70] hms_1.1.3            ggplot2_3.5.2        scales_1.4.0        </span></span>
<span><span class="co">#&gt;  [73] origami_1.0.7        globals_0.18.0       class_7.3-23        </span></span>
<span><span class="co">#&gt;  [76] glue_1.8.0           tools_4.5.0          data.table_1.17.6   </span></span>
<span><span class="co">#&gt;  [79] ModelMetrics_1.2.2.2 rstackdeque_1.1.1    gower_1.0.2         </span></span>
<span><span class="co">#&gt;  [82] fs_1.6.6             visNetwork_2.1.2     grid_4.5.0          </span></span>
<span><span class="co">#&gt;  [85] rbibutils_2.3        ipred_0.9-15         nlme_3.1-168        </span></span>
<span><span class="co">#&gt;  [88] BBmisc_1.13          cli_3.6.5            textshaping_1.0.1   </span></span>
<span><span class="co">#&gt;  [91] lava_1.8.1           gtable_0.3.6         R.methodsS3_1.8.2   </span></span>
<span><span class="co">#&gt;  [94] sass_0.4.10          digest_0.6.37        caret_7.0-1         </span></span>
<span><span class="co">#&gt;  [97] htmlwidgets_1.6.4    farver_2.1.2         htmltools_0.5.8.1   </span></span>
<span><span class="co">#&gt; [100] pkgdown_2.1.3        R.oo_1.27.1          lifecycle_1.0.4     </span></span>
<span><span class="co">#&gt; [103] hardhat_1.4.1        MASS_7.3-65</span></span></code></pre></div>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-bahamyirou2022" class="csl-entry">
Bahamyirou, Asma, Mireille E. Schnitzer, Edward H. Kennedy, Lucie Blais,
and Yi Yang. 2022. <span>“Doubly Robust Adaptive LASSO for Effect
Modifier Discovery.”</span> <em>The International Journal of
Biostatistics</em>. <a href="https://doi.org/doi:10.1515/ijb-2020-0073" class="external-link">https://doi.org/doi:10.1515/ijb-2020-0073</a>.
</div>
<div id="ref-boileau2023" class="csl-entry">
Boileau, Philippe, Ning Leng, Nima S Hejazi, Mark van der Laan, and
Sandrine Dudoit. 2025. <span>“A Nonparametric Framework for Treatment
Effect Modifier Discovery in High Dimensions.”</span> <em>Journal of the
Royal Statistical Society Series B: Statistical Methodology</em>. <a href="https://doi.org/10.1093/jrsssb/qkae084" class="external-link">https://doi.org/10.1093/jrsssb/qkae084</a>.
</div>
<div id="ref-boileau2022" class="csl-entry">
Boileau, Philippe, Nina Ting Qi, Mark J van der Laan, Sandrine Dudoit,
and Ning Leng. 2022. <span>“<span class="nocase">A flexible approach for
predictive biomarker discovery</span>.”</span> <em>Biostatistics</em>,
July. <a href="https://doi.org/10.1093/biostatistics/kxac029" class="external-link">https://doi.org/10.1093/biostatistics/kxac029</a>.
</div>
<div id="ref-breiman2001" class="csl-entry">
Breiman, Leo. 2001. <span>“Random Forests.”</span> <em>Machine
Learning</em> 45 (1): 5–32.
</div>
<div id="ref-chen2017" class="csl-entry">
Chen, Shuai, Lu Tian, Tianxi Cai, and Menggang Yu. 2017. <span>“A
General Statistical Framework for Subgroup Identification and
Comparative Treatment Scoring.”</span> <em>Biometrics</em> 73 (4):
1199–209. https://doi.org/<a href="https://doi.org/10.1111/biom.12676" class="external-link">https://doi.org/10.1111/biom.12676</a>.
</div>
<div id="ref-chen2016" class="csl-entry">
Chen, Tianqi, and Carlos Guestrin. 2016. <span>“<span>XGBoost</span>: A
Scalable Tree Boosting System.”</span> In <em>Proceedings of the 22nd
ACM SIGKDD International Conference on Knowledge Discovery and Data
Mining</em>, 785–94. KDD ’16. New York, NY, USA: ACM. <a href="https://doi.org/10.1145/2939672.2939785" class="external-link">https://doi.org/10.1145/2939672.2939785</a>.
</div>
<div id="ref-cherno2017" class="csl-entry">
Chernozhukov, Victor, Denis Chetverikov, Mert Demirer, Esther Duflo,
Christian Hansen, and Whitney Newey. 2017. <span>“Double/Debiased/Neyman
Machine Learning of Treatment Effects.”</span> <em>American Economic
Review</em> 107 (5): 261–65. <a href="https://doi.org/10.1257/aer.p20171038" class="external-link">https://doi.org/10.1257/aer.p20171038</a>.
</div>
<div id="ref-coyle2021sl3-rpkg" class="csl-entry">
Coyle, Jeremy R, Nima S Hejazi, Ivana Malenica, Rachael V Phillips, and
Oleg Sofrygin. 2021. <span>“<span class="nocase">sl3</span>: Modern
Pipelines for Machine Learning and <span>Super Learning</span>.”</span>
<a href="https://github.com/tlverse/sl3" class="external-link uri">https://github.com/tlverse/sl3</a>. <a href="https://doi.org/10.5281/zenodo.1342293" class="external-link">https://doi.org/10.5281/zenodo.1342293</a>.
</div>
<div id="ref-cui2022" class="csl-entry">
Cui, Yifan, Michael R. Kosorok, Erik Sverdrup, Stefan Wager, and Ruoqing
Zhu. 2022. arXiv. <a href="https://doi.org/10.48550/ARXIV.2001.09887" class="external-link">https://doi.org/10.48550/ARXIV.2001.09887</a>.
</div>
<div id="ref-friedman1991" class="csl-entry">
Friedman, Jerome H. 1991. <span>“<span>Multivariate Adaptive Regression
Splines</span>.”</span> <em>The Annals of Statistics</em> 19 (1): 1–67.
</div>
<div id="ref-esl2009" class="csl-entry">
Hastie, Trevor, Robert Tibshirani, and Jerome Friedman. 2009. <em>The
Elements of Statistical Learning: Data Mining, Inference and
Prediction</em>. 2nd ed. Springer. <a href="http://www-stat.stanford.edu/~tibs/ElemStatLearn/" class="external-link">http://www-stat.stanford.edu/~tibs/ElemStatLearn/</a>.
</div>
<div id="ref-hejazi2022" class="csl-entry">
Hejazi, Nima S, Philippe Boileau, Mark J van der Laan, and Alan E
Hubbard. <span>“A Generalization of Moderated Statistics to Data
Adaptive Semiparametric Estimation in High-Dimensional Biology.”</span>
<em>Statistical Methods in Medical Research</em> 0 (0):
09622802221146313.
</div>
<div id="ref-hines2022TEVIP" class="csl-entry">
Hines, Oliver, Karla Diaz-Ordaz, and Stijn Vansteelandt. 2022.
<span>“Variable Importance Measures for Heterogeneous Causal
Effects.”</span> arXiv. <a href="https://doi.org/10.48550/ARXIV.2204.06030" class="external-link">https://doi.org/10.48550/ARXIV.2204.06030</a>.
</div>
<div id="ref-vdl2007" class="csl-entry">
Laan, Mark J. van der, Eric C Polley, and Alan E. Hubbard. 2007.
<span>“Super Learner.”</span> <em>Statistical Applications in Genetics
and Molecular Biology</em> 6 (1). <a href="https://doi.org/doi:10.2202/1544-6115.1309" class="external-link">https://doi.org/doi:10.2202/1544-6115.1309</a>.
</div>
<div id="ref-tlverse-sl3" class="csl-entry">
Phillips, Rachael. 2023. <span>“Targeted Learning in <span>R</span>:
Causal Data Science with the <span class="nocase">tlverse</span>
Software Ecosystem.”</span> In. <a href="https://tlverse.org/tlverse-handbook/sl3.html" class="external-link">https://tlverse.org/tlverse-handbook/sl3.html</a>.
</div>
<div id="ref-rubin1974" class="csl-entry">
Rubin, D. B. 1974. <span>“Estimating Causal Effects of Treatments in
Randomized and Nonrandomized Studies.”</span> <em>Journal of Educational
Psychology</em> 66 (5): 688–701.
</div>
<div id="ref-semenova2021" class="csl-entry">
Semenova, Vira, and Victor Chernozhukov. 2020. <span>“<span class="nocase">Debiased machine learning of conditional average
treatment effects and other causal functions</span>.”</span> <em>The
Econometrics Journal</em> 24 (2): 264–89. <a href="https://doi.org/10.1093/ectj/utaa027" class="external-link">https://doi.org/10.1093/ectj/utaa027</a>.
</div>
<div id="ref-tian2014" class="csl-entry">
Tian, Lu, Ash A. Alizadeh, Andrew J. Gentles, and Robert Tibshirani.
2014. <span>“A Simple Method for Estimating Interactions Between a
Treatment and a Large Number of Covariates.”</span> <em>Journal of the
American Statistical Association</em> 109 (508): 1517–32. <a href="https://doi.org/10.1080/01621459.2014.951443" class="external-link">https://doi.org/10.1080/01621459.2014.951443</a>.
</div>
<div id="ref-tibshirani1996" class="csl-entry">
Tibshirani, Robert. 1996. <span>“Regression Shrinkage and Selection via
the Lasso.”</span> <em>Journal of the Royal Statistical Society. Series
B (Methodological)</em> 58 (1): 267–88. <a href="http://www.jstor.org/stable/2346178" class="external-link">http://www.jstor.org/stable/2346178</a>.
</div>
<div id="ref-wager2018" class="csl-entry">
Wager, Stefan, and Susan Athey. 2018. <span>“Estimation and Inference of
Heterogeneous Treatment Effects Using Random Forests.”</span>
<em>Journal of the American Statistical Association</em> 113 (523):
1228–42. <a href="https://doi.org/10.1080/01621459.2017.1319839" class="external-link">https://doi.org/10.1080/01621459.2017.1319839</a>.
</div>
<div id="ref-williamson2022framework" class="csl-entry">
Williamson, Brian D., Peter B. Gilbert, Noah R. Simon, and Marco Carone.
2022. <span>“A General Framework for Inference on Algorithm-Agnostic
Variable Importance.”</span> <em>Journal of the American Statistical
Association</em> 0 (0): 1–14.
</div>
<div id="ref-ranger" class="csl-entry">
Wright, Marvin N., and Andreas Ziegler. 2017. <span>“Ranger: A Fast
Implementation of Random Forests for High Dimensional Data in c++ and
r.”</span> <em>Journal of Statistical Software</em> 77 (1): 1–17.
</div>
<div id="ref-zhao2006" class="csl-entry">
Zhao, Peng, and Bin Yu. 2006. <span>“On Model Selection Consistency of
Lasso.”</span> <em>Journal of Machine Learning Research</em> 7 (90):
2541–63. <a href="http://jmlr.org/papers/v7/zhao06a.html" class="external-link">http://jmlr.org/papers/v7/zhao06a.html</a>.
</div>
<div id="ref-zhao2018" class="csl-entry">
Zhao, Qingyuan, Dylan S. Small, and Ashkan Ertefaie. 2018.
<span>“Selective Inference for Effect Modification via the
Lasso.”</span> <a href="https://arxiv.org/abs/1705.08020" class="external-link">https://arxiv.org/abs/1705.08020</a>.
</div>
<div id="ref-zheng2011cross" class="csl-entry">
Zheng, Wenjing, and Mark J van der Laan. 2011. <span>“Cross-Validated
Targeted Minimum-Loss-Based Estimation.”</span> In <em>Targeted
Learning: Causal Inference for Observational and Experimental Data</em>,
459–74. Springer.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Philippe Boileau.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
